<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>图像处理大作业 | SHIVAKASU</title><meta name="description" content="0 图像灰度化、直方图均衡、灰度线性拉伸 原理太简单，略~  1 图像的离散傅里叶变换与逆变换1.1 简介 离散傅里叶变换 (DFT)，是傅里叶变换在时域和频域上都呈现离散的形式，将时域信号的采样变换为在离散时间傅里叶变换 (DTFT) 频域的采样。在形式上，变换两端 (时域和频域上) 的序列是有限长的，而实际上这两组序列都应当被认为是离散周期信号的主值序列。即使对有限长的离散信号作 DFT，也应"><meta name="keywords" content="Java,图像处理"><meta name="author" content="w.k.x.,wkx1996@foxmail.com"><meta name="copyright" content="w.k.x."><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="https://file.shivakasu.cn/eb8581b76ec032ab0db8/favicon.ico"><link rel="canonical" href="https://shivakasu.cn/2017/04/01/work2/"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//fonts.googleapis.com" crossorigin="crossorigin"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta property="og:type" content="article"><meta property="og:title" content="图像处理大作业"><meta property="og:url" content="https://shivakasu.cn/2017/04/01/work2/"><meta property="og:site_name" content="SHIVAKASU"><meta property="og:description" content="0 图像灰度化、直方图均衡、灰度线性拉伸 原理太简单，略~  1 图像的离散傅里叶变换与逆变换1.1 简介 离散傅里叶变换 (DFT)，是傅里叶变换在时域和频域上都呈现离散的形式，将时域信号的采样变换为在离散时间傅里叶变换 (DTFT) 频域的采样。在形式上，变换两端 (时域和频域上) 的序列是有限长的，而实际上这两组序列都应当被认为是离散周期信号的主值序列。即使对有限长的离散信号作 DFT，也应"><meta property="og:image" content="https://file.shivakasu.cn/2f6de001e698ed5939de/arg.jpg"><meta property="article:published_time" content="2017-04-01T10:41:20.000Z"><meta property="article:modified_time" content="2017-04-01T15:34:20.000Z"><meta name="twitter:card" content="summary"><script>var activateDarkMode = function () {
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#000')
  }
}
var activateLightMode = function () {
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null) {
    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#fff')
  }
}

var getCookies = function (name) {
  const value = `; ${document.cookie}`
  const parts = value.split(`; ${name}=`)
  if (parts.length === 2) return parts.pop().split(';').shift()
}

var autoChangeMode = 'false'
var t = getCookies('theme')
if (autoChangeMode === '1') {
  var isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
  var isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
  var isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
  var hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

  if (t === undefined) {
    if (isLightMode) activateLightMode()
    else if (isDarkMode) activateDarkMode()
    else if (isNotSpecified || hasNoSupport) {
      console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
      var now = new Date()
      var hour = now.getHours()
      var isNight = hour <= 6 || hour >= 18
      isNight ? activateDarkMode() : activateLightMode()
    }
    window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
      if (Cookies.get('theme') === undefined) {
        e.matches ? activateDarkMode() : activateLightMode()
      }
    })
  } else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else if (autoChangeMode === '2') {
  now = new Date()
  hour = now.getHours()
  isNight = hour <= 6 || hour >= 18
  if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode()
} else {
  if (t === 'dark') activateDarkMode()
  else if (t === 'light') activateLightMode()
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="prev" title="解决 anaconda3 安装 xgboost：/usr/lib/libstdc++.so.6：version 'GLIBCXX_3.4.14' not found问题" href="https://shivakasu.cn/2017/07/01/bugfix0/"><link rel="next" title="无聊的知识点之大数据" href="https://shivakasu.cn/2017/01/28/interview5/"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web&amp;display=swap"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  runtime: true,
  copyright: {"languages":{"author":"作者: w.k.x.","link":"链接: ","source":"来源: SHIVAKASU","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  baiduPush: false,
  highlightCopy: true,
  highlightLang: true,
  isPhotoFigcaption: true,
  islazyload: true,
  isanchor: true    
}</script><script>var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true
  }</script><noscript><style>
#nav {
  opacity: 1
}
.justified-gallery img{
  opacity: 1
}
</style></noscript><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="SHIVAKASU" type="application/atom+xml">
</head><body><canvas class="fireworks"></canvas><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://file.shivakasu.cn/cb7049104af4685e7289/avatar.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">46</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">19</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">6</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fa fa-book"></i><span> Book</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0-图像灰度化、直方图均衡、灰度线性拉伸"><span class="toc-text">0 图像灰度化、直方图均衡、灰度线性拉伸</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#1-图像的离散傅里叶变换与逆变换"><span class="toc-text">1 图像的离散傅里叶变换与逆变换</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-1-简介"><span class="toc-text">1.1 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-2-公式"><span class="toc-text">1.2 公式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-3-基2-FFT算法原理"><span class="toc-text">1.3 基2 FFT算法原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-4-效果"><span class="toc-text">1.4 效果</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#2-图像的离散余弦变换与逆变换"><span class="toc-text">2 图像的离散余弦变换与逆变换</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-1-简介"><span class="toc-text">2.1 简介</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-公式"><span class="toc-text">2.2 公式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-3-基于FFT的快速离散余弦变换算法原理"><span class="toc-text">2.3 基于FFT的快速离散余弦变换算法原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-4-效果"><span class="toc-text">2.4 效果</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-基于JPEG压缩算法的图像压缩"><span class="toc-text">3 基于JPEG压缩算法的图像压缩</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-1-步骤与原理"><span class="toc-text">3.1 步骤与原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-效果"><span class="toc-text">3.2 效果</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-基于DCT的图像数字水印嵌入与提取"><span class="toc-text">4 基于DCT的图像数字水印嵌入与提取</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-步骤与原理"><span class="toc-text">4.1 步骤与原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-效果"><span class="toc-text">4.2 效果</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#5-边缘检测"><span class="toc-text">5 边缘检测</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#5-1-原理"><span class="toc-text">5.1 原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-2-常用算子"><span class="toc-text">5.2 常用算子</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-1-Sobel算子"><span class="toc-text">5.2.1 Sobel算子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-2-Prewitt算子"><span class="toc-text">5.2.2 Prewitt算子</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-3-Laplace算子"><span class="toc-text">5.2.3 Laplace算子</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-3-效果"><span class="toc-text">5.3 效果</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#6-源码"><span class="toc-text">6 源码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#MainWindow-java-应用主窗口"><span class="toc-text">MainWindow.java (应用主窗口)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Complex-java-复数运算"><span class="toc-text">Complex.java (复数运算)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OpenListener-java-打开图片"><span class="toc-text">OpenListener.java (打开图片)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GrayListener-java-图像灰度化"><span class="toc-text">GrayListener.java (图像灰度化)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HistogramListener-java-图像直方图均衡"><span class="toc-text">HistogramListener.java (图像直方图均衡)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GrayStretchListener-java-图像灰度线性拉伸"><span class="toc-text">GrayStretchListener.java (图像灰度线性拉伸)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FFT-java-快速傅里叶变换与逆变换算法"><span class="toc-text">FFT.java (快速傅里叶变换与逆变换算法)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#fourierListener-java-快速傅里叶变换应用"><span class="toc-text">fourierListener.java (快速傅里叶变换应用)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cosineListener-java-基于快速傅里叶变换的快速离散余弦变换"><span class="toc-text">cosineListener.java (基于快速傅里叶变换的快速离散余弦变换)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RevokeListener-java-撤销操作"><span class="toc-text">RevokeListener.java (撤销操作)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#blockDCT-java-基于矩阵运算的离散余弦变换"><span class="toc-text">blockDCT.java (基于矩阵运算的离散余弦变换)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Compress-java-基于离散余弦变换的图像压缩算法"><span class="toc-text">Compress.java (基于离散余弦变换的图像压缩算法)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#compressListener-java-基于离散余弦变换的图像压缩应用"><span class="toc-text">compressListener.java (基于离散余弦变换的图像压缩应用)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#waterMark-java-水印嵌入与提取算法"><span class="toc-text">waterMark.java (水印嵌入与提取算法)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#watermarkListener-java-水印嵌入应用"><span class="toc-text">watermarkListener.java (水印嵌入应用)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#waterrecoverListener-java-水印提取应用"><span class="toc-text">waterrecoverListener.java (水印提取应用)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#edgeListener-java-边缘检测"><span class="toc-text">edgeListener.java (边缘检测)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#7-Demo-程序"><span class="toc-text">7 Demo 程序</span></a></li></ol></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://file.shivakasu.cn/2f6de001e698ed5939de/arg.jpg)"><nav id="nav"><span class="pull-left" id="blog_name"><a class="blog_title" id="site-name" href="/">SHIVAKASU</a></span><span class="pull-right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down menus-expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li><li><a class="site-page" href="/books/"><i class="fa-fw fa fa-book"></i><span> Book</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><span class="toggle-menu close"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">图像处理大作业</div></div><div id="post-meta"><div class="meta-firstline"><time class="post-meta__date"><span class="post-meta__date-created" title="发表于 2017-04-01 18:41:20"><i class="far fa-calendar-alt fa-fw"></i> 发表于 2017-04-01</span><span class="post-meta__separator">|</span><span class="post-meta__date-updated" title="更新于 2017-04-01 23:34:20"><i class="fas fa-history fa-fw"></i> 更新于 2017-04-01</span></time><span class="post-meta__categories"><span class="post-meta__separator">|</span><i class="fas fa-inbox fa-fw post-meta__icon"></i><a class="post-meta__categories" href="/categories/%E7%BC%96%E7%A8%8B%E5%AE%9E%E8%B7%B5/">编程实践</a></span></div><div class="meta-secondline"> <span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta__icon"></i><span>字数总计:</span><span class="word-count">12.3k</span><span class="post-meta__separator">|</span><i class="far fa-clock fa-fw post-meta__icon"></i><span>阅读时长: 65 分钟</span></span></div><div class="meta-thirdline"><span class="post-meta-pv-cv"><span class="post-meta__separator">|</span><i class="far fa-eye fa-fw post-meta__icon"></i><span>阅读量:</span><span id="busuanzi_value_page_pv"></span></span><span class="post-meta-commentcount"><span class="post-meta__separator">|</span><i class="far fa-comments fa-fw post-meta__icon"></i><span>评论数:</span><a href="/2017/04/01/work2/#post-comment" itemprop="discussionUrl"><span class="valine-comment-count comment-count" data-xid="/2017/04/01/work2/" itemprop="commentCount"></span></a></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="0-图像灰度化、直方图均衡、灰度线性拉伸"><a href="#0-图像灰度化、直方图均衡、灰度线性拉伸" class="headerlink" title="0 图像灰度化、直方图均衡、灰度线性拉伸"></a>0 图像灰度化、直方图均衡、灰度线性拉伸</h1><ul>
<li>原理太简单，略~</li>
</ul>
<h1 id="1-图像的离散傅里叶变换与逆变换"><a href="#1-图像的离散傅里叶变换与逆变换" class="headerlink" title="1 图像的离散傅里叶变换与逆变换"></a>1 图像的离散傅里叶变换与逆变换</h1><h2 id="1-1-简介"><a href="#1-1-简介" class="headerlink" title="1.1 简介"></a>1.1 简介</h2><ul>
<li>离散傅里叶变换 (DFT)，是傅里叶变换在时域和频域上都呈现离散的形式，将时域信号的采样变换为在离散时间傅里叶变换 (DTFT) 频域的采样。在形式上，变换两端 (时域和频域上) 的序列是有限长的，而实际上这两组序列都应当被认为是离散周期信号的主值序列。即使对有限长的离散信号作 DFT，也应当将其看作经过周期延拓成为周期信号再作变换。在实际应用中通常采用快速傅里叶变换 (FFT) 以高效计算 DFT。FFT的逆变换可通过共轭-&gt;FFT-&gt;共轭-&gt;缩放实现。</li>
</ul>
<h2 id="1-2-公式"><a href="#1-2-公式" class="headerlink" title="1.2 公式"></a>1.2 公式</h2><p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/69a47e3250763c3a1d1c/w21.png" alt=""></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/11556cde633eaee38c02/w22.png" alt=""></p>
<h2 id="1-3-基2-FFT算法原理"><a href="#1-3-基2-FFT算法原理" class="headerlink" title="1.3 基2 FFT算法原理"></a>1.3 基2 FFT算法原理</h2><p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/9cac007fbac37beb00a6/w23.png" alt=""></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/5a0a2f05bcbe93b10055/w24.png" alt=""></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/c7a686c44ce80a0738bd/w25.png" alt=""></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/b32c7d1b7f5005af9c7b/w26.png" alt=""></p>
<h2 id="1-4-效果"><a href="#1-4-效果" class="headerlink" title="1.4 效果"></a>1.4 效果</h2><p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/086168cbb3400c5871eb/w27.jpg" alt="原图"></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/ab2aac2577822701dba5/w28.png" alt="频谱"></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/2eddb4046a573ced739b/w29.png" alt="逆变换结果"></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/b8e1f9a2683eceb155ee/w210.png" alt="原图"></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/5ab8ab4dae2a12fe5b04/w211.png" alt="频谱"></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/a48359145e8b2e38b92f/w212.png" alt="逆变换结果"></p>
<h1 id="2-图像的离散余弦变换与逆变换"><a href="#2-图像的离散余弦变换与逆变换" class="headerlink" title="2 图像的离散余弦变换与逆变换"></a>2 图像的离散余弦变换与逆变换</h1><h2 id="2-1-简介"><a href="#2-1-简介" class="headerlink" title="2.1 简介"></a>2.1 简介</h2><ul>
<li>离散余弦变换 (DCT for Discrete Cosine Transform) 是与傅里叶变换相关的一种变换，它类似于离散傅里叶变换 (DFT for Discrete Fourier Transform) , 但是只使用实数。离散余弦变换相当于一个长度大概是它两倍的离散傅里叶变换，这个离散傅里叶变换是对一个实偶函数进行的 (因为一个实偶函数的傅里叶变换仍然是一个实偶函数) ，在有些变形里面需要将输入或者输出的位置移动半个单位。DCT有8种标准类型，其中4种是常见的。</li>
</ul>
<h2 id="2-2-公式"><a href="#2-2-公式" class="headerlink" title="2.2 公式"></a>2.2 公式</h2><p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/088a0184d81d90f216aa/w213.png" alt=""></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/afe6eb7cb88a54921de5/w214.png" alt=""></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/04d5302b9e4edf03c31e/w215.png" alt=""></p>
<h2 id="2-3-基于FFT的快速离散余弦变换算法原理"><a href="#2-3-基于FFT的快速离散余弦变换算法原理" class="headerlink" title="2.3 基于FFT的快速离散余弦变换算法原理"></a>2.3 基于FFT的快速离散余弦变换算法原理</h2><p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/218bfbf1460996c8f2cb/w216.png" alt=""></p>
<ul>
<li>借助傅里叶变换计算余弦变换的步骤：<ul>
<li>把 $f(x)$ 延拓成 $f_e(x)$ ，长度为 $2N$</li>
<li>求 $f_e(x)$ 的 $2N$ 点的 FFT</li>
<li>对 $u$ 各项乘上对应的因子 $\sqrt{2}exp{-j\frac{\pi u}{2N}}$</li>
<li>取实部，并乘上因子 $\sqrt{\frac{1}{N}}$</li>
<li>取 $F(u)$ 的前 $N$ 项，即为 $f(x)$ 的余弦变换</li>
</ul>
</li>
<li>同理，IDCT 可由 $F_e(u)e^{j\frac{\pi u}{2N}}$ 的 $2N$ 点的 IFFT 实现。</li>
</ul>
<h2 id="2-4-效果"><a href="#2-4-效果" class="headerlink" title="2.4 效果"></a>2.4 效果</h2><p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/74851ddce5fa0277d15f/w217.jpg" alt="原图"></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/9cca62dc9826e95529e2/w218.png" alt="频谱"></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/64f639fe0c6e35d31921/w219.png" alt="逆变换结果"></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/5277a8cef6162fade926/w220.png" alt="原图"></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/adf49fc748855ff0261a/w221.png" alt="频谱"></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/b5cc5ebe7d11a05070f7/w222.png" alt="逆变换结果"></p>
<h1 id="3-基于JPEG压缩算法的图像压缩"><a href="#3-基于JPEG压缩算法的图像压缩" class="headerlink" title="3 基于JPEG压缩算法的图像压缩"></a>3 基于JPEG压缩算法的图像压缩</h1><h2 id="3-1-步骤与原理"><a href="#3-1-步骤与原理" class="headerlink" title="3.1 步骤与原理"></a>3.1 步骤与原理</h2><p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/c65512a4d1cca6c15b3b/w223.png" alt="JPEG压缩算法"></p>
<ul>
<li>DCT：由于 DCT 主要应用在数据和图像的压缩，因此希望原信号的能量在变换后能尽量集中在少数系数上，且这些大能量的系数能处在相对集中的位置，这将有利于进一步的量化和编码。但是如果对整段的数据或整幅图像来做 DCT，那就很难保证大能量的系数能处在相对集中的位置。因此，在实际应用中，一般都是将数据分成一段一段来做，一般分成 8x8。<ul>
<li>首先将颜色空间转换为YUV，转换公式为：<script type="math/tex; mode=display">Y=0.299R+0.587G+0.114B\\
Cb=-0.1687R-0.3313G+0.5B+128\\
Cr=0.5R-0.418G-0.0813B+128</script></li>
<li>然后将图像的像素值减去 128，将像素值控制在 -128~127 之间进行 DCT 变换。</li>
<li>由于是 8x8 矩阵的 DCT 变换，故采用基于 FFT 的算法没有优势，更由于 FFT 引入复数运算，使计算过程变得复杂。因此此处采用基于变换矩阵的算法，即：</li>
</ul>
</li>
</ul>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/ef4bd4561fa63bfc4fef/w224.png" alt=""></p>
<ul>
<li>程序中使用了矩阵运算的第三方 Java 库 jama ，结果表明使用变换矩阵算法的速度远远高于 FFT 和原生 DCT 算法。<ul>
<li>量化：经过DCT变换后的数据，极大限度的去除了相关性，并且实现了能量的集中，那么会出现数据特别大而多数数据特别小的情况。量化的过程就是对这些数据做新的映射处理，目的是减少非“0”系数的幅度以及增加“0”值系数的数目。</li>
</ul>
</li>
</ul>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/681eb07c520ecc931355/w225.png" alt=""></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/f03785c9572cda845953/w226.png" alt=""></p>
<ul>
<li>Zigzag 扫描：DCT 将一个 8x8 的数组变换成另一个 8x8 的数组. 但是内存里所有数据都是线形存放的, 如果我们一行行的存放这 64 个数字, 每行的结尾的点和下行开始的点就没有什么关系, 所以 JPEG 规定按如下顺序依次保存和读取 64 个 DCT 的系数值：从 8*8 矩阵的左上角开始，按照英文字母 Z 的形状进行扫描的，一般将其称之为 Zigzag 扫描排序。如下图所示：</li>
</ul>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/bbf7ace5c24adb4db8f0/w227.png" alt=""></p>
<ul>
<li>Huffman 编码：对出现概率大的字符分配字符长度较短的二进制编码，对出现概率小的字符分配字符长度较长的二进制编码，从而使得字符的平均编码长度最短。Huffman 编码时 DC 系数与 AC 系数分别采用不同的 Huffman 编码表，对于亮度和色度也采用不同的 Huffman 编码表。因此，需要 4 张 Huffman 编码表才能完成熵编码的工作。具体的 Huffman 编码采用查表的方式来高效地完成。然而，在 JPEG 标准中没有定义缺省的 Huffman 表，用户可以根据实际应用自由选择，也可以使用 JPEG 标准推荐的 Huffman 表。或者预先定义一个通用的 Huffman 表，也可以针对一副特定的图像，在压缩编码前通过搜集其统计特征来计算 Huffman 表的值。</li>
</ul>
<h2 id="3-2-效果"><a href="#3-2-效果" class="headerlink" title="3.2 效果"></a>3.2 效果</h2><ul>
<li>标题栏注明了量化参数和压缩后文件大小，单位 KB</li>
</ul>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/47a92f8b0d7a86023c96/w228.png" alt=""></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/21c11ee75335ef29309a/w229.png" alt=""></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/458a94d665730ce3c4d3/w230.png" alt=""></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/523ff65ae234087e5a07/w231.png" alt=""></p>
<h1 id="4-基于DCT的图像数字水印嵌入与提取"><a href="#4-基于DCT的图像数字水印嵌入与提取" class="headerlink" title="4 基于DCT的图像数字水印嵌入与提取"></a>4 基于DCT的图像数字水印嵌入与提取</h1><h2 id="4-1-步骤与原理"><a href="#4-1-步骤与原理" class="headerlink" title="4.1 步骤与原理"></a>4.1 步骤与原理</h2><ul>
<li>首先参照图像压缩时的步骤，将原图像按照8x8的大小分块并进行DCT变换。然后对照原图像的分块将水印图像进行适当扩展并分成同样数量的块。对于嵌入位置的选择，由于嵌入低频区域对原图像影响较大，而嵌入高频区域很容易被过滤，因此选择将水印图像嵌入8x8块的中频部分。</li>
<li>显然，嵌入位置的选择限制了水印图像的大小，使用过大的图片会导致嵌入失败。</li>
<li>提取水印时只需将携带水印的图像分块进行DCT变换，然后从每一块的中频区域提取水印图像的信息。</li>
</ul>
<h2 id="4-2-效果"><a href="#4-2-效果" class="headerlink" title="4.2 效果"></a>4.2 效果</h2><p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/29afcb837404c0efc942/w232.png" alt="原图像"></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/5690489c1f5fbc539d2b/w233.png" alt="水印图像"></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/1331d8e337a8c753bdc8/w234.png" alt="水印嵌入结果"></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/71a9f34e78f95f246e88/w235.png" alt="水印提取结果"></p>
<ul>
<li>由于DCT变换涉及浮点数与整数的转换，因此图像会有一定损失，但是我不太清楚是不是因为代码写错了，使得图像有如此规律的黑色竖纹。诡异的是，对于下面这幅图像就没有黑色竖纹。时间原因，没能解决这一问题。</li>
</ul>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/64cb8a02ec3fb81cfd45/w236.png" alt="水印图像"></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/1b39d7bd35fddb0c8891/w237.png" alt="水印嵌入结果"></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/9dc140be30b9901e79fe/w238.png" alt="水印提取结果"></p>
<h1 id="5-边缘检测"><a href="#5-边缘检测" class="headerlink" title="5 边缘检测"></a>5 边缘检测</h1><h2 id="5-1-原理"><a href="#5-1-原理" class="headerlink" title="5.1 原理"></a>5.1 原理</h2><ul>
<li>边缘 (edge) 是指图像局部强度变化最显著的部分。主要存在于目标与目标、目标与背景、区域与区域(包括不同色彩)之间，是图像分割、纹理特征和形状特征等图像分析的重要基础。</li>
<li>图像强度的显著变化可分为：<ul>
<li>阶跃变化函数，即图像强度在不连续处的两边的像素灰度值有着显著的差异；</li>
<li>线条 (屋顶) 变化函数，即图像强度突然从一个值变化到另一个值，保持一较小行程后又回到原来的值。</li>
</ul>
</li>
<li>图像的边缘有方向和幅度两个属性,沿边缘方向像素变化平缓,垂直于边缘方向像素变化剧烈.边缘上的这种变化可以用微分算子检测出来,通常用一阶或二阶导数来检测边缘。</li>
</ul>
<h2 id="5-2-常用算子"><a href="#5-2-常用算子" class="headerlink" title="5.2 常用算子"></a>5.2 常用算子</h2><h3 id="5-2-1-Sobel算子"><a href="#5-2-1-Sobel算子" class="headerlink" title="5.2.1 Sobel算子"></a>5.2.1 Sobel算子</h3><ul>
<li>主要用于边缘检测，在技术上它是以离散型的差分算子，用来运算图像亮度函数的梯度的近似值，Sobel 算子是典型的基于一阶导数的边缘检测算子，由于该算子中引入了类似局部平均的运算，因此对噪声具有平滑作用，能很好的消除噪声的影响。Sobel 算子对于像素位置的影响做了加权，与 Prewitt 算子、Roberts 算子相比效果更好。</li>
<li>Sobel 算子包含两组3x3的矩阵，分别为横向及纵向模板，将之与图像作平面卷积，即可分别得出横向及纵向的亮度差分近似值。实际使用中，常用如下两个模板来检测图像边缘：<ul>
<li>检测水平边沿横向模板：<script type="math/tex; mode=display">G_x=\left[ \begin{matrix} -1 & 0 & 1 \\ -2 & 0 & 2 \\ -1 & 0 & 1 \end{matrix} \right]</script></li>
<li>检测垂直平边沿纵向模板：<script type="math/tex; mode=display">G_y=\left[ \begin{matrix} 1 & 2 & 1 \\ 0 & 0 & 0 \\ -1 & -2 & -1 \end{matrix} \right]</script></li>
</ul>
</li>
<li>图像的每一个像素的横向及纵向梯度近似值可用以下的公式结合，来计算梯度的大小:<script type="math/tex; mode=display">G=\sqrt{G_x^2+G_y^2}</script></li>
<li>缺点是Sobel算子并没有将图像的主题与背景严格地区分开来，换言之就是Sobel算子并没有基于图像灰度进行处理，由于Sobel算子并没有严格地模拟人的视觉生理特征，所以提取的图像轮廓有时并不能令人满意。</li>
</ul>
<h3 id="5-2-2-Prewitt算子"><a href="#5-2-2-Prewitt算子" class="headerlink" title="5.2.2 Prewitt算子"></a>5.2.2 Prewitt算子</h3><ul>
<li>Prewitt 算子是一种一阶微分算子的边缘检测，利用像素点上下、左右邻点的灰度差，在边缘处达到极值检测边缘，去掉部分伪边缘，对噪声具有平滑作用 。其原理是在图像空间利用两个方向模板与图像进行邻域卷积来完成的，这两个方向模板一个检测水平边缘，一个检测垂直边缘。</li>
<li>经典 Prewitt 算子认为：凡灰度新值大于或等于阈值的像素点都是边缘点。即选择适当的阈值 $T$ ，若 $P(i,j)\ge T$ ，则 $(i,j)$ 为边缘点，$P(i,j)$ 为边缘图像。这种判定是欠合理的，会造成边缘点的误判，因为许多噪声点的灰度值也很大，而且对于幅值较小的边缘点，其边缘反而丢失了。</li>
<li>Prewitt 算子对噪声有抑制作用，抑制噪声的原理是通过像素平均，但是像素平均相当于对图像的低通滤波，所以 Prewitt 算子对边缘的定位不如 Roberts 算子。</li>
<li>因为平均能减少或消除噪声，Prewitt 梯度算子法就是先求平均，再求差分来求梯度。水平和垂直梯度模板分别为：</li>
</ul>
<script type="math/tex; mode=display">G_x=\left[ \begin{matrix} -1 & 0 & 1 \\ -1 & 0 & 1 \\ -1 & 0 & 1 \end{matrix} \right]</script><script type="math/tex; mode=display">G_y=\left[ \begin{matrix} 1 & 1 & 1 \\ 0 & 0 & 0 \\ -1 & -1 & -1 \end{matrix} \right]</script><ul>
<li>该算子与 Sobel 算子类似，只是权值有所变化，但两者实现起来功能还是有差距的，据经验得知 Sobel 要比 Prewitt 更能准确检测图像边缘。</li>
</ul>
<h3 id="5-2-3-Laplace算子"><a href="#5-2-3-Laplace算子" class="headerlink" title="5.2.3 Laplace算子"></a>5.2.3 Laplace算子</h3><ul>
<li>Laplace 算子是一种各向同性算子，二阶微分算子，在只关心边缘的位置而不考虑其周围的象素灰度差值时比较合适。Laplace 算子对孤立象素的响应要比对边缘或线的响应要更强烈，因此只适用于无噪声图象。存在噪声情况下，使用 Laplacian 算子检测边缘之前需要先进行低通滤波。所以，通常的分割算法都是把 Laplacian 算子和平滑算子结合起来生成一个新的模板。</li>
<li>Laplace 算子也是最简单的各向同性微分算子，具有旋转不变性。一个二维图像函数的拉普拉斯变换是各向同性的二阶导数，定义：</li>
</ul>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/520460d50d9e61526629/w239.gif" alt=""></p>
<ul>
<li>Laplace 算子一般不以其原始形式用于边缘检测，因为其作为一个二阶导数，Laplace 算子对噪声具有无法接受的敏感性，同时其幅值产生算边缘，这是复杂的分割不希望有的结果，最后 Laplace 算子不能检测边缘的方向，所以 Laplace 在分割中所起的作用包括：<ul>
<li>利用它的零交叉性质进行边缘定位</li>
<li>确定一个像素是在一条边缘暗的一面还是亮的一面</li>
</ul>
</li>
<li>一般使用的是高斯型拉普拉斯算子 (Laplace of a Gaussian,LoG) ，由于二阶导数是线性运算，利用 LoG 卷积一幅图像与首先使用高斯型平滑函数卷积改图像，然后计算所得结果的拉普拉斯是一样的。所以在 LoG 公式中使用高斯函数的目的就是对图像进行平滑处理，使用 Laplace 算子的目的是提供一幅用零交叉确定边缘位置的图像；图像的平滑处理减少了噪声的影响并且它的主要作用还是抵消由 Laplace 算子的二阶导数引起的逐渐增加的噪声影响。</li>
</ul>
<h2 id="5-3-效果"><a href="#5-3-效果" class="headerlink" title="5.3 效果"></a>5.3 效果</h2><p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/8e91ed363ae2ad27d7b9/w240.png" alt=""></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/3f37825330dae0e4d8c8/w241.png" alt=""></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/2c154b27f55968d9b328/w242.png" alt=""></p>
<p><img src= "/img/loading.gif" data-src="https://file.shivakasu.cn/d8332b720bd9077659fa/w243.png" alt=""></p>
<h1 id="6-源码"><a href="#6-源码" class="headerlink" title="6 源码"></a>6 源码</h1><h2 id="MainWindow-java-应用主窗口"><a href="#MainWindow-java-应用主窗口" class="headerlink" title="MainWindow.java (应用主窗口)"></a>MainWindow.java (应用主窗口)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.ColorModel;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.MemoryImageSource;</span><br><span class="line"><span class="keyword">import</span> javax.imageio.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.event.ChangeEvent;</span><br><span class="line"><span class="keyword">import</span> javax.swing.event.ChangeListener;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.PixelGrabber;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.text.DecimalFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainWindow</span> <span class="keyword">extends</span> <span class="title">JFrame</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> currPixArray[] = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> sourcePixArray[] = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">public</span> JLabel imageLabel = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">public</span> JScrollPane pane=<span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> height;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> width;</span><br><span class="line">    <span class="keyword">public</span> BufferedImage image=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> cosineListener cosine=<span class="keyword">new</span> cosineListener(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">MainWindow</span><span class="params">(String title)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(title);</span><br><span class="line">        JMenuBar bar = <span class="keyword">new</span> JMenuBar();</span><br><span class="line">        JMenu fileMenu = <span class="keyword">new</span> JMenu(<span class="string">"文件  "</span>);</span><br><span class="line">        bar.add(fileMenu);</span><br><span class="line">        JMenuItem openImage = <span class="keyword">new</span> JMenuItem(<span class="string">"打开图片"</span>);</span><br><span class="line">        fileMenu.add(openImage);</span><br><span class="line">        openImage.addActionListener(<span class="keyword">new</span> OpenListener(<span class="keyword">this</span>));</span><br><span class="line">        JMenuItem exitItem = <span class="keyword">new</span> JMenuItem(<span class="string">"退出"</span>);</span><br><span class="line">        fileMenu.add(exitItem);</span><br><span class="line">        exitItem.addActionListener(<span class="keyword">new</span> ActionListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">                System.exit(<span class="number">0</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        JMenu processMenu = <span class="keyword">new</span> JMenu(<span class="string">"p1  "</span>);</span><br><span class="line">        bar.add(processMenu);</span><br><span class="line">        JMenuItem revoke = <span class="keyword">new</span> JMenuItem(<span class="string">"还原"</span>);</span><br><span class="line">        processMenu.add(revoke);</span><br><span class="line">        revoke.addActionListener(<span class="keyword">new</span> RevokeListener(<span class="keyword">this</span>));</span><br><span class="line">        JMenuItem toGray = <span class="keyword">new</span> JMenuItem(<span class="string">"灰度化"</span>);</span><br><span class="line">        processMenu.add(toGray);</span><br><span class="line">        toGray.addActionListener(<span class="keyword">new</span> GrayListener(<span class="keyword">this</span>));</span><br><span class="line">        JMenuItem toBalance = <span class="keyword">new</span> JMenuItem(<span class="string">"直方图均衡"</span>);</span><br><span class="line">        processMenu.add(toBalance);</span><br><span class="line">        toBalance.addActionListener(<span class="keyword">new</span> HistogramListener(<span class="keyword">this</span>));</span><br><span class="line">        JMenuItem grayStretch = <span class="keyword">new</span> JMenuItem(<span class="string">"线性拉伸"</span>);</span><br><span class="line">        processMenu.add(grayStretch);</span><br><span class="line">        grayStretch.addActionListener(<span class="keyword">new</span> GrayStretchListener(<span class="keyword">this</span>));</span><br><span class="line"></span><br><span class="line">        JMenu processMenu2 = <span class="keyword">new</span> JMenu(<span class="string">"p2  "</span>);</span><br><span class="line">        bar.add(processMenu2);</span><br><span class="line">        JMenuItem fourier = <span class="keyword">new</span> JMenuItem(<span class="string">"DFT / IDFT"</span>);</span><br><span class="line">        processMenu2.add(fourier);</span><br><span class="line">        fourier.addActionListener(<span class="keyword">new</span> fourierListener(<span class="keyword">this</span>));</span><br><span class="line">        JMenuItem cosin = <span class="keyword">new</span> JMenuItem(<span class="string">"DCT / IDCT"</span>);</span><br><span class="line">        processMenu2.add(cosin);</span><br><span class="line">        cosin.addActionListener(cosine);</span><br><span class="line">        JMenuItem compress = <span class="keyword">new</span> JMenuItem(<span class="string">"DCT图像压缩"</span>);</span><br><span class="line">        processMenu2.add(compress);</span><br><span class="line">        compress.addActionListener(<span class="keyword">new</span> compressListener(<span class="keyword">this</span>));</span><br><span class="line">        JMenuItem watermark = <span class="keyword">new</span> JMenuItem(<span class="string">"DCT数字水印"</span>);</span><br><span class="line">        processMenu2.add(watermark);</span><br><span class="line">        watermark.addActionListener(<span class="keyword">new</span> watermarkListener(<span class="keyword">this</span>));</span><br><span class="line">        JMenuItem waterrecover = <span class="keyword">new</span> JMenuItem(<span class="string">"数字水印提取"</span>);</span><br><span class="line">        processMenu2.add(waterrecover);</span><br><span class="line">        waterrecover.addActionListener(<span class="keyword">new</span> waterrecoverListener(<span class="keyword">this</span>));</span><br><span class="line"></span><br><span class="line">        JMenu processMenu3 = <span class="keyword">new</span> JMenu(<span class="string">"p3  "</span>);</span><br><span class="line">        bar.add(processMenu3);</span><br><span class="line">        JMenuItem sobel = <span class="keyword">new</span> JMenuItem(<span class="string">"sobel边缘检测"</span>);</span><br><span class="line">        processMenu3.add(sobel);</span><br><span class="line">        sobel.addActionListener(<span class="keyword">new</span> edgeListener(<span class="keyword">this</span>,<span class="string">"sobel"</span>));</span><br><span class="line">        JMenuItem prewitt = <span class="keyword">new</span> JMenuItem(<span class="string">"prewitt边缘检测"</span>);</span><br><span class="line">        processMenu3.add(prewitt);</span><br><span class="line">        prewitt.addActionListener(<span class="keyword">new</span> edgeListener(<span class="keyword">this</span>,<span class="string">"prewitt"</span>));</span><br><span class="line">        JMenuItem laplace = <span class="keyword">new</span> JMenuItem(<span class="string">"laplace边缘检测"</span>);</span><br><span class="line">        processMenu3.add(laplace);</span><br><span class="line">        laplace.addActionListener(<span class="keyword">new</span> edgeListener(<span class="keyword">this</span>,<span class="string">"laplace"</span>));</span><br><span class="line"></span><br><span class="line">        <span class="keyword">this</span>.setJMenuBar(bar);</span><br><span class="line"></span><br><span class="line">        imageLabel = <span class="keyword">new</span> JLabel(<span class="string">""</span>);</span><br><span class="line">        pane = <span class="keyword">new</span> JScrollPane(imageLabel);</span><br><span class="line">        <span class="keyword">this</span>.add(pane, BorderLayout.CENTER);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">showImage</span><span class="params">(<span class="keyword">int</span>[] array)</span> </span>&#123;</span><br><span class="line">        Image pic = <span class="keyword">this</span>.createImage(<span class="keyword">new</span> MemoryImageSource(width, height,array, <span class="number">0</span>, width));</span><br><span class="line">        ImageIcon icon = <span class="keyword">new</span> ImageIcon(pic);</span><br><span class="line">        imageLabel.setIcon(icon);</span><br><span class="line">        imageLabel.repaint();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String args[])</span> </span>&#123;</span><br><span class="line">        MainWindow process = <span class="keyword">new</span> MainWindow(<span class="string">"IM"</span>);</span><br><span class="line">        process.setDefaultCloseOperation(WindowConstants.EXIT_ON_CLOSE);</span><br><span class="line">        process.setLocationRelativeTo(<span class="keyword">null</span>);</span><br><span class="line">        process.setMinimumSize(<span class="keyword">new</span> Dimension(<span class="number">300</span>,<span class="number">300</span>));</span><br><span class="line">        process.setSize(<span class="number">300</span>, <span class="number">300</span>);</span><br><span class="line">        process.setVisible(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Complex-java-复数运算"><a href="#Complex-java-复数运算" class="headerlink" title="Complex.java (复数运算)"></a>Complex.java (复数运算)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Complex</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">double</span> re;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">double</span> im;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Complex</span><span class="params">(<span class="keyword">double</span> real, <span class="keyword">double</span> imag)</span> </span>&#123;</span><br><span class="line">        re = real;</span><br><span class="line">        im = imag;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">abs</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Math.hypot(re, im);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Complex <span class="title">plus</span><span class="params">(Complex b)</span> </span>&#123;</span><br><span class="line">        Complex a = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">double</span> real = a.re + b.re;</span><br><span class="line">        <span class="keyword">double</span> imag = a.im + b.im;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Complex(real, imag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Complex <span class="title">minus</span><span class="params">(Complex b)</span> </span>&#123;</span><br><span class="line">        Complex a = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">double</span> real = a.re - b.re;</span><br><span class="line">        <span class="keyword">double</span> imag = a.im - b.im;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Complex(real, imag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Complex <span class="title">times</span><span class="params">(Complex b)</span> </span>&#123;</span><br><span class="line">        Complex a = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">double</span> real = a.re * b.re - a.im * b.im;</span><br><span class="line">        <span class="keyword">double</span> imag = a.re * b.im + a.im * b.re;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Complex(real, imag);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Complex <span class="title">scale</span><span class="params">(<span class="keyword">double</span> alpha)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Complex(alpha * re, alpha * im);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Complex <span class="title">conjugate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Complex(re, -im);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">re</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> re;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">im</span><span class="params">()</span></span>&#123;<span class="keyword">return</span> im;&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="OpenListener-java-打开图片"><a href="#OpenListener-java-打开图片" class="headerlink" title="OpenListener.java (打开图片)"></a>OpenListener.java (打开图片)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.PixelGrabber;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OpenListener</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> MainWindow mainWindow;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">OpenListener</span><span class="params">(MainWindow mainWindow)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mainWindow = mainWindow;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">        JFileChooser file = <span class="keyword">new</span> JFileChooser();</span><br><span class="line">        String filePath;</span><br><span class="line">        <span class="keyword">int</span> feedback = file.showOpenDialog(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (feedback == JFileChooser.APPROVE_OPTION) &#123;</span><br><span class="line">            File target = file.getSelectedFile();</span><br><span class="line">            <span class="keyword">if</span> (target != <span class="keyword">null</span>) &#123;</span><br><span class="line">                filePath = target.getAbsolutePath();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    mainWindow.image = ImageIO.read(<span class="keyword">new</span> File(filePath));</span><br><span class="line">                    mainWindow.width = mainWindow.image.getWidth();</span><br><span class="line">                    mainWindow.height = mainWindow.image.getHeight();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//////////////////dangerous/////////////</span></span><br><span class="line">                    mainWindow.cosine.setWidth(mainWindow.image.getWidth());</span><br><span class="line">                    mainWindow.cosine.setHeight(mainWindow.image.getHeight());</span><br><span class="line">                    <span class="comment">//////////////////////////////////////</span></span><br><span class="line"></span><br><span class="line">                    PixelGrabber p;</span><br><span class="line">                    <span class="keyword">int</span>[] array = <span class="keyword">new</span> <span class="keyword">int</span>[mainWindow.width * mainWindow.height];</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        p = <span class="keyword">new</span> PixelGrabber(mainWindow.image, <span class="number">0</span>, <span class="number">0</span>, mainWindow.width, mainWindow.height, array, <span class="number">0</span>, mainWindow.width);</span><br><span class="line">                        <span class="keyword">if</span> (!p.grabPixels())</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                <span class="keyword">throw</span> <span class="keyword">new</span> Exception();</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (Exception e1) &#123;&#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e2)&#123;&#125;</span><br><span class="line">                    mainWindow.currPixArray = array;</span><br><span class="line">                    mainWindow.sourcePixArray = array;</span><br><span class="line">                    mainWindow.imageLabel.setIcon(<span class="keyword">new</span> ImageIcon(mainWindow.image));</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e3) &#123;&#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mainWindow.repaint();</span><br><span class="line">        mainWindow.setSize(mainWindow.width+<span class="number">22</span>,mainWindow.height+<span class="number">76</span>);</span><br><span class="line">        mainWindow.pane.setSize(mainWindow.width,mainWindow.height);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="GrayListener-java-图像灰度化"><a href="#GrayListener-java-图像灰度化" class="headerlink" title="GrayListener.java (图像灰度化)"></a>GrayListener.java (图像灰度化)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.ColorModel;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GrayListener</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> MainWindow mainWindow;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GrayListener</span><span class="params">(MainWindow mainWindow)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mainWindow = mainWindow;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span>[] array = <span class="keyword">new</span> <span class="keyword">int</span>[mainWindow.height * mainWindow.width];</span><br><span class="line">        ColorModel colorModel = ColorModel.getRGBdefault();</span><br><span class="line">        <span class="keyword">int</span> i, j, k, r, g, b;</span><br><span class="line">        <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; mainWindow.height; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (j = <span class="number">0</span>; j &lt; mainWindow.width; j++) &#123;</span><br><span class="line">                k = i * mainWindow.width + j;</span><br><span class="line">                r = colorModel.getRed(mainWindow.currPixArray[k]);</span><br><span class="line">                g = colorModel.getGreen(mainWindow.currPixArray[k]);</span><br><span class="line">                b = colorModel.getBlue(mainWindow.currPixArray[k]);</span><br><span class="line">                r = g = b = (<span class="keyword">int</span>) (r * <span class="number">0.3</span> + g * <span class="number">0.59</span> + b * <span class="number">0.11</span>);</span><br><span class="line">                array[k] = (<span class="number">255</span> &lt;&lt; <span class="number">24</span>) | (r &lt;&lt; <span class="number">16</span>) | (g &lt;&lt; <span class="number">8</span>) | b;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mainWindow.currPixArray = array;</span><br><span class="line">        mainWindow.showImage(array);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="HistogramListener-java-图像直方图均衡"><a href="#HistogramListener-java-图像直方图均衡" class="headerlink" title="HistogramListener.java (图像直方图均衡)"></a>HistogramListener.java (图像直方图均衡)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HistogramListener</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> MainWindow mainWindow;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">HistogramListener</span><span class="params">(MainWindow mainWindow)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mainWindow = mainWindow;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> grayLevel; <span class="comment">// 每个像素的灰度级</span></span><br><span class="line">        <span class="keyword">int</span>[] grayArray = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">256</span>]; <span class="comment">// 记录每个灰度级出现的像素数量</span></span><br><span class="line">        <span class="keyword">int</span>[] resPixArray = <span class="keyword">new</span> <span class="keyword">int</span>[mainWindow.width * mainWindow.height]; <span class="comment">// 均衡化之后的新像素矩阵</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mainWindow.height; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; mainWindow.width; j++) &#123;</span><br><span class="line">                grayLevel = mainWindow.currPixArray[i * mainWindow.width + j] &amp; <span class="number">0xff</span>; <span class="comment">// 后8位为该像素的灰度级</span></span><br><span class="line">                grayArray[grayLevel]++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">double</span>[] p = <span class="keyword">new</span> <span class="keyword">double</span>[<span class="number">256</span>]; <span class="comment">// 记录每个灰度级的出现的概率</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">256</span>; i++) &#123;</span><br><span class="line">            p[i] = (<span class="keyword">double</span>) grayArray[i] / (mainWindow.width * mainWindow.height);</span><br><span class="line">        &#125;</span><br><span class="line">        grayArray[<span class="number">0</span>] = (<span class="keyword">int</span>) (p[<span class="number">0</span>] * <span class="number">255</span> + <span class="number">0.5</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">255</span>; i++) &#123;</span><br><span class="line">            p[i + <span class="number">1</span>] += p[i];</span><br><span class="line">            grayArray[i + <span class="number">1</span>] = (<span class="keyword">int</span>) (p[i + <span class="number">1</span>] * <span class="number">255</span> + <span class="number">0.5</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> oldGray, newGray;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mainWindow.height; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; mainWindow.width; j++) &#123;</span><br><span class="line">                oldGray = mainWindow.currPixArray[i * mainWindow.width + j] &amp; <span class="number">0x0000ff</span>;</span><br><span class="line">                newGray = grayArray[oldGray];</span><br><span class="line">                resPixArray[i * mainWindow.width + j] = <span class="number">255</span> &lt;&lt; <span class="number">24</span> | newGray &lt;&lt; <span class="number">16</span> | newGray &lt;&lt; <span class="number">8</span> | newGray;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        mainWindow.currPixArray = resPixArray;</span><br><span class="line">        mainWindow.showImage(resPixArray);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="GrayStretchListener-java-图像灰度线性拉伸"><a href="#GrayStretchListener-java-图像灰度线性拉伸" class="headerlink" title="GrayStretchListener.java (图像灰度线性拉伸)"></a>GrayStretchListener.java (图像灰度线性拉伸)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.event.ChangeEvent;</span><br><span class="line"><span class="keyword">import</span> javax.swing.event.ChangeListener;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GrayStretchListener</span> <span class="keyword">extends</span> <span class="title">JFrame</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> MainWindow mainWindow;</span><br><span class="line">    <span class="keyword">private</span> JSlider slider1,slider2,slider3,slider4;</span><br><span class="line">    <span class="keyword">private</span> JLabel label1,label2,label3,label4;</span><br><span class="line">    <span class="keyword">private</span> JButton ok,cancle;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> a, b, c, d;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">GrayStretchListener</span><span class="params">(MainWindow mainWindow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mainWindow = mainWindow;</span><br><span class="line">        JPanel panel = <span class="keyword">new</span> JPanel();</span><br><span class="line">        panel.setLayout(<span class="keyword">null</span>);</span><br><span class="line">        slider1 = <span class="keyword">new</span> JSlider(<span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">        slider2 = <span class="keyword">new</span> JSlider(<span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">        slider3 = <span class="keyword">new</span> JSlider(<span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">        slider4 = <span class="keyword">new</span> JSlider(<span class="number">0</span>, <span class="number">255</span>);</span><br><span class="line">        label1 = <span class="keyword">new</span> JLabel(<span class="string">"127"</span>);</span><br><span class="line">        label2 = <span class="keyword">new</span> JLabel(<span class="string">"127"</span>);</span><br><span class="line">        label3 = <span class="keyword">new</span> JLabel(<span class="string">"127"</span>);</span><br><span class="line">        label4 = <span class="keyword">new</span> JLabel(<span class="string">"127"</span>);</span><br><span class="line">        panel.add(slider1);</span><br><span class="line">        slider1.setBounds(<span class="number">20</span>, <span class="number">20</span>, <span class="number">270</span>, <span class="number">20</span>);</span><br><span class="line">        panel.add(label1);</span><br><span class="line">        label1.setBounds(<span class="number">290</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">20</span>);</span><br><span class="line">        panel.add(slider2);</span><br><span class="line">        slider2.setBounds(<span class="number">20</span>, <span class="number">70</span>, <span class="number">270</span>, <span class="number">20</span>);</span><br><span class="line">        panel.add(label2);</span><br><span class="line">        label2.setBounds(<span class="number">290</span>, <span class="number">70</span>, <span class="number">30</span>, <span class="number">20</span>);</span><br><span class="line">        panel.add(slider3);</span><br><span class="line">        slider3.setBounds(<span class="number">20</span>, <span class="number">120</span>, <span class="number">270</span>, <span class="number">20</span>);</span><br><span class="line">        panel.add(label3);</span><br><span class="line">        label3.setBounds(<span class="number">290</span>, <span class="number">120</span>, <span class="number">30</span>, <span class="number">20</span>);</span><br><span class="line">        panel.add(slider4);</span><br><span class="line">        slider4.setBounds(<span class="number">20</span>, <span class="number">170</span>, <span class="number">270</span>, <span class="number">20</span>);</span><br><span class="line">        panel.add(label4);</span><br><span class="line">        label4.setBounds(<span class="number">290</span>, <span class="number">170</span>, <span class="number">30</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">        slider1.addChangeListener(<span class="keyword">new</span> ChangeListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stateChanged</span><span class="params">(ChangeEvent e)</span> </span>&#123;</span><br><span class="line">                label1.setText(String.valueOf(slider1.getValue()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        slider2.addChangeListener(<span class="keyword">new</span> ChangeListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stateChanged</span><span class="params">(ChangeEvent e)</span> </span>&#123;</span><br><span class="line">                label2.setText(String.valueOf(slider2.getValue()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        slider3.addChangeListener(<span class="keyword">new</span> ChangeListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stateChanged</span><span class="params">(ChangeEvent e)</span> </span>&#123;</span><br><span class="line">                label3.setText(String.valueOf(slider3.getValue()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        slider4.addChangeListener(<span class="keyword">new</span> ChangeListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stateChanged</span><span class="params">(ChangeEvent e)</span> </span>&#123;</span><br><span class="line">                label4.setText(String.valueOf(slider4.getValue()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        ok = <span class="keyword">new</span> JButton(<span class="string">"确定"</span>);</span><br><span class="line">        panel.add(ok);</span><br><span class="line">        ok.addActionListener(<span class="keyword">new</span> ActionListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">                a = slider1.getValue();</span><br><span class="line">                b = slider2.getValue();</span><br><span class="line">                c = slider3.getValue();</span><br><span class="line">                d = slider4.getValue();</span><br><span class="line">                <span class="keyword">int</span>[] resultArray = <span class="keyword">new</span> <span class="keyword">int</span>[mainWindow.width * mainWindow.height];</span><br><span class="line">                <span class="keyword">int</span> oldGray, newGray;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mainWindow.height; i++) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; mainWindow.width; j++) &#123;</span><br><span class="line">                        oldGray = mainWindow.currPixArray[i * mainWindow.width + j] &amp; <span class="number">0x0000ff</span>;</span><br><span class="line">                        <span class="keyword">if</span> (oldGray &lt; a)</span><br><span class="line">                            newGray = c;</span><br><span class="line">                        <span class="keyword">else</span> <span class="keyword">if</span> (oldGray &lt; b)</span><br><span class="line">                            newGray = (<span class="keyword">int</span>) (<span class="number">1.0</span> * (d - c) / (b - a) * (oldGray - a) + c);</span><br><span class="line">                        <span class="keyword">else</span></span><br><span class="line">                            newGray = d;</span><br><span class="line">                        resultArray[i * mainWindow.width + j] = <span class="number">255</span> &lt;&lt; <span class="number">24</span> | newGray &lt;&lt; <span class="number">16</span> | newGray &lt;&lt; <span class="number">8</span> | newGray;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                mainWindow.currPixArray = resultArray;</span><br><span class="line">                mainWindow.showImage(resultArray);</span><br><span class="line">                dispose();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        ok.setBounds(<span class="number">60</span>, <span class="number">220</span>, <span class="number">80</span>, <span class="number">30</span>);</span><br><span class="line">        cancle = <span class="keyword">new</span> JButton(<span class="string">"取消"</span>);</span><br><span class="line">        panel.add(cancle);</span><br><span class="line">        cancle.addActionListener(<span class="keyword">new</span> ActionListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">                dispose();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        cancle.setBounds(<span class="number">200</span>, <span class="number">220</span>, <span class="number">80</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        Container c = getContentPane();</span><br><span class="line">        c.setLayout(<span class="keyword">new</span> BoxLayout(c, BoxLayout.Y_AXIS));</span><br><span class="line">        c.add(panel);</span><br><span class="line">        <span class="keyword">this</span>.setVisible(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">this</span>.setLocationRelativeTo(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">this</span>.setSize(<span class="number">380</span>, <span class="number">300</span>);</span><br><span class="line">        <span class="keyword">this</span>.setResizable(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">this</span>.setTitle(<span class="string">"区间设置[a,b]-&gt;[c,d]"</span>);</span><br><span class="line">        <span class="keyword">this</span>.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setVisible(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="FFT-java-快速傅里叶变换与逆变换算法"><a href="#FFT-java-快速傅里叶变换与逆变换算法" class="headerlink" title="FFT.java (快速傅里叶变换与逆变换算法)"></a>FFT.java (快速傅里叶变换与逆变换算法)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> java.awt.Color;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FFT</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> BufferedImage im;</span><br><span class="line">    <span class="keyword">private</span> Complex [][][] F;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> [][][] T;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">FFT</span><span class="params">(BufferedImage image)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.im = image;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// convert RGB int matrix into image</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> BufferedImage <span class="title">RGBtoImage</span> <span class="params">(<span class="keyword">int</span>[][][]m)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> w = m[<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">int</span> h = m[<span class="number">0</span>][<span class="number">0</span>].length;</span><br><span class="line">        BufferedImage output_img = <span class="keyword">new</span> BufferedImage(w, h, BufferedImage.TYPE_INT_RGB);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h; j++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w; i++)&#123;</span><br><span class="line">                <span class="keyword">int</span> gray=(<span class="keyword">int</span>)(m[<span class="number">0</span>][i][j]*<span class="number">0.3</span>+m[<span class="number">1</span>][i][j]*<span class="number">0.59</span>+m[<span class="number">2</span>][i][j]*<span class="number">0.11</span>);</span><br><span class="line">                Color color = <span class="keyword">new</span> Color(m[<span class="number">0</span>][i][j],m[<span class="number">1</span>][i][j],m[<span class="number">2</span>][i][j]);</span><br><span class="line">                output_img.setRGB(i,j, color.getRGB());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> output_img;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Complex[] fft1(Complex[] array) &#123;</span><br><span class="line">        <span class="keyword">int</span> n = array.length;</span><br><span class="line">        <span class="keyword">if</span> (n == <span class="number">1</span>) <span class="keyword">return</span> <span class="keyword">new</span> Complex[] &#123; array[<span class="number">0</span>] &#125;;</span><br><span class="line">        <span class="keyword">if</span> (n % <span class="number">2</span> != <span class="number">0</span>) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"n is not a power of 2"</span>); &#125;</span><br><span class="line">        Complex[] even = <span class="keyword">new</span> Complex[n/<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; n/<span class="number">2</span>; k++) &#123;</span><br><span class="line">            even[k] = array[<span class="number">2</span>*k];</span><br><span class="line">        &#125;</span><br><span class="line">        Complex[] q = fft1(even);</span><br><span class="line">        Complex[] odd  = even;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; n/<span class="number">2</span>; k++) &#123;</span><br><span class="line">            odd[k] = array[<span class="number">2</span>*k + <span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        Complex[] r = fft1(odd);</span><br><span class="line">        Complex[] y = <span class="keyword">new</span> Complex[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; n/<span class="number">2</span>; k++) &#123;</span><br><span class="line">            <span class="keyword">double</span> kth = -<span class="number">2</span> * k * Math.PI / n;</span><br><span class="line">            Complex wk = <span class="keyword">new</span> Complex(Math.cos(kth), Math.sin(kth));</span><br><span class="line">            y[k]       = q[k].plus(wk.times(r[k]));</span><br><span class="line">            y[k + n/<span class="number">2</span>] = q[k].minus(wk.times(r[k]));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Complex[][][] fft2(Complex[][][] m)&#123;</span><br><span class="line">        <span class="keyword">int</span> w = m[<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">int</span> h = m[<span class="number">0</span>][<span class="number">0</span>].length;</span><br><span class="line">        Complex[][][] output = <span class="keyword">new</span> Complex[<span class="number">3</span>][w][h];</span><br><span class="line">        Complex [] row = <span class="keyword">new</span> Complex [w];</span><br><span class="line">        Complex [] col = <span class="keyword">new</span> Complex [h];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;<span class="number">3</span>; k++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h; j++)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w; i++)&#123;</span><br><span class="line">                    row[i] = m[k][i][j];</span><br><span class="line">                &#125;</span><br><span class="line">                row = fft1(row);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w; i++)</span><br><span class="line">                    output[k][i][j] = row[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w; i++)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h; j++)&#123;</span><br><span class="line">                    col[j] = output[k][i][j];</span><br><span class="line">                &#125;</span><br><span class="line">                col = fft1(col);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h; j++)</span><br><span class="line">                    output[k][i][j] = col[j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Complex[] ifft1(Complex[] x) &#123;</span><br><span class="line">        <span class="keyword">int</span> n = x.length;</span><br><span class="line">        Complex[] y = <span class="keyword">new</span> Complex[n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            y[i] = x[i].conjugate();</span><br><span class="line">        &#125;</span><br><span class="line">        y = fft1(y);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            y[i] = y[i].conjugate();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            y[i] = y[i].scale(<span class="number">1.0</span> / n);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> y;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Complex[][][] ifft2 (Complex[][][] m)&#123;</span><br><span class="line">        <span class="keyword">int</span> w = m[<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">int</span> h = m[<span class="number">0</span>][<span class="number">0</span>].length;</span><br><span class="line">        Complex[][][] output = <span class="keyword">new</span> Complex[<span class="number">3</span>][w][h];</span><br><span class="line">        Complex [] row = <span class="keyword">new</span> Complex [w];</span><br><span class="line">        Complex [] col = <span class="keyword">new</span> Complex [h];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;<span class="number">3</span>; k++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h; j++)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w; i++)&#123;</span><br><span class="line">                    row[i] = m[k][i][j];</span><br><span class="line">                &#125;</span><br><span class="line">                row = ifft1(row);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w; i++)</span><br><span class="line">                    output[k][i][j] = row[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w; i++)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h; j++)&#123;</span><br><span class="line">                    col[j] = output[k][i][j];</span><br><span class="line">                &#125;</span><br><span class="line">                col = ifft1(col);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h; j++) &#123;</span><br><span class="line">                    output[k][i][j] = col[j];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[][][] imgToMatrix(BufferedImage img, <span class="keyword">int</span> w, <span class="keyword">int</span> h,<span class="keyword">boolean</span> expend,<span class="keyword">boolean</span> RGB)&#123;</span><br><span class="line">        <span class="keyword">int</span> w1,h1;</span><br><span class="line">        <span class="keyword">int</span>[][][] output;</span><br><span class="line">        <span class="keyword">if</span> (((w &amp; (w - <span class="number">1</span>)) != <span class="number">0</span>  || (h &amp; (h - <span class="number">1</span>)) != <span class="number">0</span>) &amp;&amp; expend )&#123; <span class="comment">// check if it is w or h is power of 2 int</span></span><br><span class="line">            <span class="keyword">if</span> ((w &amp; (w - <span class="number">1</span>)) != <span class="number">0</span> ) &#123;w1 = (<span class="keyword">int</span>)Math.pow(<span class="number">2</span>,Math.ceil(Math.log(w)/Math.log(<span class="number">2</span>)));&#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;w1 = w;&#125;</span><br><span class="line">            <span class="keyword">if</span> ((h &amp; (h - <span class="number">1</span>)) != <span class="number">0</span>)&#123;h1 = (<span class="keyword">int</span>)Math.pow(<span class="number">2</span>,Math.ceil(Math.log(h)/Math.log(<span class="number">2</span>)));&#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;h1 = h;&#125;</span><br><span class="line">            output = <span class="keyword">new</span> <span class="keyword">int</span> [<span class="number">3</span>][w1][h1];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;<span class="number">3</span>; k++)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h1; j++)&#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w1; i++)&#123;</span><br><span class="line">                        output[k][i][j]=<span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            output = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>][w][h];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h; j++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w; i++)&#123;</span><br><span class="line">                <span class="keyword">int</span> pixel = img.getRGB(i,j);</span><br><span class="line">                Color color = <span class="keyword">new</span> Color(pixel);</span><br><span class="line">                <span class="keyword">int</span> R = color.getRed();</span><br><span class="line">                <span class="keyword">int</span> G = color.getGreen();</span><br><span class="line">                <span class="keyword">int</span> B = color.getBlue();</span><br><span class="line">                <span class="keyword">if</span>(RGB)&#123;</span><br><span class="line">                    output[<span class="number">0</span>][i][j] = R;</span><br><span class="line">                    output[<span class="number">1</span>][i][j] = G;</span><br><span class="line">                    output[<span class="number">2</span>][i][j] = B;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    output[<span class="number">0</span>][i][j] = (<span class="keyword">int</span>)(<span class="number">0.299</span>*R+<span class="number">0.587</span>*G+<span class="number">0.114</span>*B);</span><br><span class="line">                    output[<span class="number">1</span>][i][j] = (<span class="keyword">int</span>)(-<span class="number">0.1687</span>*R-<span class="number">0.3313</span>*G+<span class="number">0.5</span>*B+<span class="number">128</span>);</span><br><span class="line">                    output[<span class="number">2</span>][i][j] = (<span class="keyword">int</span>)(<span class="number">0.5</span>*R-<span class="number">0.418</span>*G-<span class="number">0.0813</span>*B+<span class="number">128</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//The high frequency values will be shifted to the center in spectrum after applying "shift_to_center"</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span>[][][] shift_to_center(<span class="keyword">int</span>[][][] matrix)&#123;</span><br><span class="line">        <span class="keyword">int</span> w = matrix[<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">int</span> h = matrix[<span class="number">0</span>][<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;<span class="number">3</span>; k++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h; j++)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w; i++)&#123;</span><br><span class="line">                    <span class="keyword">if</span> ((i+j)%<span class="number">2</span> != <span class="number">0</span>)&#123;</span><br><span class="line">                        matrix[k][i][j] = ~matrix[k][i][j];</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> matrix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//convert from int matrix to complex number matrix</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Complex[][][] getComplexMatrix(<span class="keyword">int</span> [][][] matrix)&#123;</span><br><span class="line">        <span class="keyword">int</span> w = matrix[<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">int</span> h = matrix[<span class="number">0</span>][<span class="number">0</span>].length;</span><br><span class="line">        Complex [][][] output = <span class="keyword">new</span> Complex [<span class="number">3</span>][w][h];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;<span class="number">3</span>; k++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h; j++)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w; i++)&#123;</span><br><span class="line">                    output[k][i][j] = <span class="keyword">new</span> Complex((<span class="keyword">double</span>)(matrix[k][i][j]), (<span class="keyword">double</span>)(<span class="number">0</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (a&gt;=b)</span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">scale</span><span class="params">(<span class="keyword">int</span> a)</span></span>&#123; <span class="comment">//keep image values within 0 to 255</span></span><br><span class="line">        <span class="keyword">if</span> (a&lt;<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (a&gt;<span class="number">255</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="number">255</span>;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> BufferedImage <span class="title">complexToImg</span> <span class="params">(Complex [][][] matrix, Boolean spectrum)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> w = matrix[<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">int</span> h = matrix[<span class="number">0</span>][<span class="number">0</span>].length;</span><br><span class="line">        BufferedImage output = <span class="keyword">new</span> BufferedImage(w, h, BufferedImage.TYPE_INT_ARGB);</span><br><span class="line">        <span class="keyword">int</span> [][][] m = <span class="keyword">new</span> <span class="keyword">int</span> [<span class="number">3</span>][w][h];</span><br><span class="line">        <span class="keyword">int</span> max = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;<span class="number">3</span>; k++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j&lt;h; j++)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;w; i++)&#123;</span><br><span class="line">                    <span class="keyword">if</span> (spectrum)&#123;</span><br><span class="line">                        m[k][i][j] = (<span class="keyword">int</span>)Math.log(matrix[k][i][j].abs()+<span class="number">1</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span>&#123;</span><br><span class="line">                        m[k][i][j] = (<span class="keyword">int</span>)matrix[k][i][j].abs();</span><br><span class="line">                        m[k][i][j] = scale(m[k][i][j]);</span><br><span class="line">                    &#125;</span><br><span class="line">                    max = max(max, m[k][i][j]);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (spectrum)&#123;</span><br><span class="line">            <span class="keyword">int</span> C = <span class="number">255</span>/max;	<span class="comment">//cofficient C used to scale the image</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;<span class="number">3</span>; k++)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j&lt;h; j++)&#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;w; i++)&#123;</span><br><span class="line">                        m[k][i][j] = (<span class="keyword">int</span>)(m[k][i][j]*C);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        output = RGBtoImage(m);</span><br><span class="line">        <span class="keyword">return</span> output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Complex [][][] crop(Complex [][][] F, <span class="keyword">int</span> w, <span class="keyword">int</span> h)&#123;</span><br><span class="line">        Complex [][][] output = <span class="keyword">new</span> Complex [<span class="number">3</span>][w][h];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;<span class="number">3</span>; k++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h; j++)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w; i++)&#123;</span><br><span class="line">                    output[k][i][j] = F[k][i][j];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BufferedImage <span class="title">fft_image</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> w0 = im.getWidth();</span><br><span class="line">        <span class="keyword">int</span> h0 = im.getHeight();</span><br><span class="line">        <span class="keyword">int</span> [][][] colors = shift_to_center(imgToMatrix(im, w0, h0,<span class="keyword">true</span>,<span class="keyword">true</span>));</span><br><span class="line">        Complex [][][] f = getComplexMatrix(colors);</span><br><span class="line">        F = fft2(f);</span><br><span class="line">        <span class="keyword">return</span> complexToImg(F, <span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BufferedImage <span class="title">ifft_image</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> w0 = im.getWidth();</span><br><span class="line">        <span class="keyword">int</span> h0 = im.getHeight();</span><br><span class="line">        <span class="keyword">int</span> w = F[<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">int</span> h = F[<span class="number">0</span>][<span class="number">0</span>].length;</span><br><span class="line">        Complex [][][] filted = ifft2(F);</span><br><span class="line">        <span class="keyword">if</span> (w != w0 || h != h0) filted = crop(filted, w0, h0);</span><br><span class="line">        <span class="keyword">return</span> complexToImg(filted,<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">double</span>[] fct1(<span class="keyword">double</span>[] array) &#123;</span><br><span class="line">        <span class="keyword">int</span> n = array.length;</span><br><span class="line">        Complex[] fd = <span class="keyword">new</span> Complex[<span class="number">2</span>*n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; n; k++) &#123;</span><br><span class="line">            fd[k] = <span class="keyword">new</span> Complex(array[k],<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = n; k &lt; <span class="number">2</span>*n; k++) &#123;</span><br><span class="line">            fd[k] = <span class="keyword">new</span> Complex(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Complex[] q = fft1(fd);</span><br><span class="line">        <span class="keyword">double</span>[] des = <span class="keyword">new</span> <span class="keyword">double</span>[n];</span><br><span class="line">        <span class="keyword">double</span> dtmp=<span class="number">1</span>/Math.sqrt(n);</span><br><span class="line">        des[<span class="number">0</span>]=q[<span class="number">0</span>].re()*dtmp;</span><br><span class="line">        dtmp*=Math.sqrt(<span class="number">2</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;n;i++)</span><br><span class="line">            des[i]=(q[i].re()*Math.cos(i*Math.PI /(n*<span class="number">2</span>))+</span><br><span class="line">                    q[i].im()*Math.sin(i*Math.PI /(n*<span class="number">2</span>)))*dtmp;</span><br><span class="line">        <span class="keyword">return</span> des;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">double</span>[][][] fct2(<span class="keyword">int</span>[][][] m,<span class="keyword">int</span> q)&#123;</span><br><span class="line">        <span class="keyword">int</span> w = m[<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">int</span> h = m[<span class="number">0</span>][<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">double</span>[][][] output = <span class="keyword">new</span> <span class="keyword">double</span>[<span class="number">3</span>][w][h];</span><br><span class="line">        <span class="keyword">double</span> [] row = <span class="keyword">new</span> <span class="keyword">double</span> [w];</span><br><span class="line">        <span class="keyword">double</span> [] col = <span class="keyword">new</span> <span class="keyword">double</span> [h];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;<span class="number">3</span>; k++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h; j++)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w; i++)&#123;</span><br><span class="line">                    row[i] = m[k][i][j];</span><br><span class="line">                &#125;</span><br><span class="line">                row = fct1(row);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w; i++)</span><br><span class="line">                    output[k][i][j] = row[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w; i++)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h; j++)&#123;</span><br><span class="line">                    col[j] = output[k][i][j];</span><br><span class="line">                &#125;</span><br><span class="line">                col = fct1(col);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h; j++) &#123;</span><br><span class="line">                    output[k][i][j] = col[j];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">double</span>[] ifct1(<span class="keyword">double</span>[] array)&#123;</span><br><span class="line">        <span class="keyword">int</span> n = array.length;</span><br><span class="line">        Complex[] fd = <span class="keyword">new</span> Complex[<span class="number">2</span>*n];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; n; k++) &#123;</span><br><span class="line">            fd[k] = (<span class="keyword">new</span> Complex(array[k]*Math.cos(k*Math.PI /(n*<span class="number">2</span>)),</span><br><span class="line">                    array[k]*Math.sin(k*Math.PI /(n*<span class="number">2</span>))));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = n; k &lt; <span class="number">2</span>*n; k++) &#123;</span><br><span class="line">            fd[k] = <span class="keyword">new</span> Complex(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        Complex[] q = ifft1(fd);</span><br><span class="line">        <span class="keyword">double</span>[] des = <span class="keyword">new</span> <span class="keyword">double</span>[n];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;n;i++)</span><br><span class="line">            des[i]=(<span class="number">1.0</span>/Math.sqrt(n)-</span><br><span class="line">                    Math.sqrt(<span class="number">2.0</span>/n))*array[<span class="number">0</span>]+Math.sqrt(<span class="number">8.0</span>*n)*q[i].re();</span><br><span class="line">        <span class="keyword">return</span> des;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">double</span>[][][] ifct2(<span class="keyword">double</span>[][][] m)&#123;</span><br><span class="line">        <span class="keyword">int</span> w = m[<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">int</span> h = m[<span class="number">0</span>][<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">double</span>[][][] output = <span class="keyword">new</span> <span class="keyword">double</span>[<span class="number">3</span>][w][h];</span><br><span class="line">        <span class="keyword">double</span> [] row = <span class="keyword">new</span> <span class="keyword">double</span> [w];</span><br><span class="line">        <span class="keyword">double</span> [] col = <span class="keyword">new</span> <span class="keyword">double</span> [h];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;<span class="number">3</span>; k++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h; j++)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w; i++)&#123;</span><br><span class="line">                    row[i] = m[k][i][j];</span><br><span class="line">                &#125;</span><br><span class="line">                row = ifct1(row);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w; i++)</span><br><span class="line">                    output[k][i][j] = row[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w; i++)&#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h; j++)&#123;</span><br><span class="line">                    col[j] = output[k][i][j];</span><br><span class="line">                &#125;</span><br><span class="line">                col = ifct1(col);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h; j++)</span><br><span class="line">                    output[k][i][j] = col[j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span>[][][] rr= <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>][w][h];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;<span class="number">3</span>; k++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h; j++)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w; i++)&#123;</span><br><span class="line">                    rr[k][i][j] = (<span class="keyword">int</span>)m[k][i][j];</span><br><span class="line">                &#125;</span><br><span class="line">        <span class="keyword">return</span> output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> BufferedImage <span class="title">ifct_image</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> w0 = im.getWidth();</span><br><span class="line">        <span class="keyword">int</span> h0 = im.getHeight();</span><br><span class="line">        <span class="keyword">int</span> w = T[<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">int</span> h = T[<span class="number">0</span>][<span class="number">0</span>].length;</span><br><span class="line">        <span class="keyword">double</span> [][][] filted = ifct2(T);</span><br><span class="line">        <span class="keyword">int</span>[][][] TT = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>][w0][h0];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;<span class="number">3</span>; k++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h0; j++)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w0; i++)&#123;</span><br><span class="line">                    TT[k][i][j] = (<span class="keyword">int</span>)filted[k][i][j];</span><br><span class="line">                &#125;</span><br><span class="line">        Complex[][][] d = getComplexMatrix(TT);</span><br><span class="line"></span><br><span class="line">        Complex[][][] ff = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (w != w0 || h != h0)</span><br><span class="line">            ff = crop(d, w0, h0);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            ff=d;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> complexToImg(ff,<span class="keyword">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> BufferedImage[] fct_image(<span class="keyword">int</span> a,<span class="keyword">int</span> b,<span class="keyword">int</span> c,<span class="keyword">int</span> d)&#123;</span><br><span class="line">        <span class="keyword">int</span> w0 = im.getWidth();</span><br><span class="line">        <span class="keyword">int</span> h0 = im.getHeight();</span><br><span class="line">        BufferedImage cache = im;</span><br><span class="line">        <span class="keyword">int</span> [][][] colors = imgToMatrix(im, w0, h0,<span class="keyword">true</span>,<span class="keyword">true</span>);</span><br><span class="line">        T = fct2(colors,<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">int</span> count=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h0; j++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w0; i++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(i+j&gt;<span class="number">299</span>) &#123;</span><br><span class="line">                    count++;</span><br><span class="line">                    T[<span class="number">0</span>][i][j] = <span class="number">0</span>;</span><br><span class="line">                    T[<span class="number">1</span>][i][j] = <span class="number">0</span>;</span><br><span class="line">                    T[<span class="number">2</span>][i][j] = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        System.out.print(w0+<span class="string">"  "</span>+h0+<span class="string">"  "</span>+count);</span><br><span class="line">        <span class="keyword">int</span> [][][] TT = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>][w0][h0];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;<span class="number">3</span>; k++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h0; j++)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w0; i++)&#123;</span><br><span class="line">                    TT[k][i][j] = (<span class="keyword">int</span>)T[k][i][j];</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//        BufferedImage jjy=null;</span></span><br><span class="line"><span class="comment">//        try&#123;</span></span><br><span class="line"><span class="comment">//            jjy=ImageIO.read(new File("E://jjy.jpg"));</span></span><br><span class="line"><span class="comment">//        &#125; catch(Exception eee)&#123;&#125;</span></span><br><span class="line"><span class="comment">//        int[][][] jjjy=imgToMatrix(jjy,jjy.getWidth(),jjy.getHeight(),false,true);</span></span><br><span class="line"><span class="comment">//        for (int k = 0; k &lt;3; k++)</span></span><br><span class="line"><span class="comment">//            for (int j = 0; j &lt; jjy.getHeight(); j++)</span></span><br><span class="line"><span class="comment">//                for (int i = 0; i &lt; jjy.getWidth(); i++)&#123;</span></span><br><span class="line"><span class="comment">//                        T[k][w0-1-i][h0-1-j] += jjjy[k][i][j]/30;</span></span><br><span class="line"><span class="comment">//                &#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> w1=<span class="number">0</span>,w2=w0,h1=<span class="number">0</span>,h2=h0;</span><br><span class="line">        <span class="keyword">if</span>(b&gt;a &amp;&amp; d&gt;c)&#123;</span><br><span class="line">            w1=a;w2=b;h1=c;h2=d;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt;<span class="number">3</span>; k++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; h0; j++)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; w0; i++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(i&lt;w1||i&gt;w2||j&lt;h1||j&gt;h2)</span><br><span class="line">                        T[k][i][j] = <span class="number">0.0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">        BufferedImage[] res = <span class="keyword">new</span> BufferedImage[<span class="number">2</span>];</span><br><span class="line">        res[<span class="number">0</span>] = ifct_image();</span><br><span class="line">        res[<span class="number">1</span>]=complexToImg(getComplexMatrix(TT),<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="fourierListener-java-快速傅里叶变换应用"><a href="#fourierListener-java-快速傅里叶变换应用" class="headerlink" title="fourierListener.java (快速傅里叶变换应用)"></a>fourierListener.java (快速傅里叶变换应用)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">fourierListener</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> MainWindow mainWindow;</span><br><span class="line">    <span class="keyword">private</span> JFrame frame1 = <span class="keyword">new</span> JFrame(<span class="string">"频谱"</span>);</span><br><span class="line">    <span class="keyword">private</span> JFrame frame2 = <span class="keyword">new</span> JFrame(<span class="string">"傅里叶逆变换"</span>);</span><br><span class="line">    <span class="keyword">private</span> JLabel label1=<span class="keyword">new</span> JLabel();</span><br><span class="line">    <span class="keyword">private</span> JLabel label2=<span class="keyword">new</span> JLabel();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">fourierListener</span><span class="params">(MainWindow mainWindow)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mainWindow = mainWindow;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mainWindow.image!=<span class="keyword">null</span>) &#123;</span><br><span class="line">            FFT trans = <span class="keyword">new</span> FFT(mainWindow.image);</span><br><span class="line">            BufferedImage spec = trans.fft_image();</span><br><span class="line">            label1.setIcon(<span class="keyword">new</span> ImageIcon(spec));</span><br><span class="line">            Container c1 = frame1.getContentPane();</span><br><span class="line">            c1.add(label1);</span><br><span class="line">            frame1.pack();</span><br><span class="line">            frame1.setVisible(<span class="keyword">true</span>);</span><br><span class="line">            BufferedImage ifft = trans.ifft_image();</span><br><span class="line">            label2.setIcon(<span class="keyword">new</span> ImageIcon(ifft));</span><br><span class="line">            Container c2 = frame2.getContentPane();</span><br><span class="line">            c2.add(label2);</span><br><span class="line">            frame2.pack();</span><br><span class="line">            frame2.setVisible(<span class="keyword">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="cosineListener-java-基于快速傅里叶变换的快速离散余弦变换"><a href="#cosineListener-java-基于快速傅里叶变换的快速离散余弦变换" class="headerlink" title="cosineListener.java (基于快速傅里叶变换的快速离散余弦变换)"></a>cosineListener.java (基于快速傅里叶变换的快速离散余弦变换)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.event.ChangeEvent;</span><br><span class="line"><span class="keyword">import</span> javax.swing.event.ChangeListener;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">cosineListener</span> <span class="keyword">extends</span> <span class="title">JFrame</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> MainWindow mainWindow;</span><br><span class="line">    <span class="keyword">private</span> JFrame frame1 = <span class="keyword">new</span> JFrame(<span class="string">"频谱"</span>);</span><br><span class="line">    <span class="keyword">private</span> JFrame frame2 = <span class="keyword">new</span> JFrame(<span class="string">"余弦逆变换图像"</span>);</span><br><span class="line">    <span class="keyword">private</span> JLabel label5=<span class="keyword">new</span> JLabel();</span><br><span class="line">    <span class="keyword">private</span> JLabel label6=<span class="keyword">new</span> JLabel();</span><br><span class="line">    <span class="keyword">private</span> JSlider slider1,slider2,slider3,slider4;</span><br><span class="line">    <span class="keyword">private</span> JLabel label1,label2,label3,label4;</span><br><span class="line">    <span class="keyword">private</span> JButton ok,cancle;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> a, b, c, d;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setWidth</span><span class="params">(<span class="keyword">int</span> width)</span></span>&#123;</span><br><span class="line">        slider1.setMaximum(width);</span><br><span class="line">        slider2.setMaximum(width);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHeight</span><span class="params">(<span class="keyword">int</span> height)</span></span>&#123;</span><br><span class="line">        slider3.setMaximum(height);</span><br><span class="line">        slider4.setMaximum(height);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">cosineListener</span><span class="params">(MainWindow mainWindow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mainWindow = mainWindow;</span><br><span class="line">        JPanel panel = <span class="keyword">new</span> JPanel();</span><br><span class="line">        panel.setLayout(<span class="keyword">null</span>);</span><br><span class="line">        slider1 = <span class="keyword">new</span> JSlider(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        slider2 = <span class="keyword">new</span> JSlider(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        slider3 = <span class="keyword">new</span> JSlider(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        slider4 = <span class="keyword">new</span> JSlider(<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">        label1 = <span class="keyword">new</span> JLabel(<span class="string">"0"</span>);</span><br><span class="line">        label2 = <span class="keyword">new</span> JLabel(<span class="string">"0"</span>);</span><br><span class="line">        label3 = <span class="keyword">new</span> JLabel(<span class="string">"0"</span>);</span><br><span class="line">        label4 = <span class="keyword">new</span> JLabel(<span class="string">"0"</span>);</span><br><span class="line">        panel.add(slider1);</span><br><span class="line">        slider1.setBounds(<span class="number">20</span>, <span class="number">20</span>, <span class="number">270</span>, <span class="number">20</span>);</span><br><span class="line">        panel.add(label1);</span><br><span class="line">        label1.setBounds(<span class="number">290</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">20</span>);</span><br><span class="line">        panel.add(slider2);</span><br><span class="line">        slider2.setBounds(<span class="number">20</span>, <span class="number">70</span>, <span class="number">270</span>, <span class="number">20</span>);</span><br><span class="line">        panel.add(label2);</span><br><span class="line">        label2.setBounds(<span class="number">290</span>, <span class="number">70</span>, <span class="number">30</span>, <span class="number">20</span>);</span><br><span class="line">        panel.add(slider3);</span><br><span class="line">        slider3.setBounds(<span class="number">20</span>, <span class="number">120</span>, <span class="number">270</span>, <span class="number">20</span>);</span><br><span class="line">        panel.add(label3);</span><br><span class="line">        label3.setBounds(<span class="number">290</span>, <span class="number">120</span>, <span class="number">30</span>, <span class="number">20</span>);</span><br><span class="line">        panel.add(slider4);</span><br><span class="line">        slider4.setBounds(<span class="number">20</span>, <span class="number">170</span>, <span class="number">270</span>, <span class="number">20</span>);</span><br><span class="line">        panel.add(label4);</span><br><span class="line">        label4.setBounds(<span class="number">290</span>, <span class="number">170</span>, <span class="number">30</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">        slider1.addChangeListener(<span class="keyword">new</span> ChangeListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stateChanged</span><span class="params">(ChangeEvent e)</span> </span>&#123;</span><br><span class="line">                label1.setText(String.valueOf(slider1.getValue()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        slider2.addChangeListener(<span class="keyword">new</span> ChangeListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stateChanged</span><span class="params">(ChangeEvent e)</span> </span>&#123;</span><br><span class="line">                label2.setText(String.valueOf(slider2.getValue()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        slider3.addChangeListener(<span class="keyword">new</span> ChangeListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stateChanged</span><span class="params">(ChangeEvent e)</span> </span>&#123;</span><br><span class="line">                label3.setText(String.valueOf(slider3.getValue()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        slider4.addChangeListener(<span class="keyword">new</span> ChangeListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stateChanged</span><span class="params">(ChangeEvent e)</span> </span>&#123;</span><br><span class="line">                label4.setText(String.valueOf(slider4.getValue()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        ok = <span class="keyword">new</span> JButton(<span class="string">"确定"</span>);</span><br><span class="line">        panel.add(ok);</span><br><span class="line">        ok.addActionListener(<span class="keyword">new</span> ActionListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(mainWindow.image!=<span class="keyword">null</span>) &#123;</span><br><span class="line">                    a = slider1.getValue();</span><br><span class="line">                    b = slider2.getValue();</span><br><span class="line">                    c = slider3.getValue();</span><br><span class="line">                    d = slider4.getValue();</span><br><span class="line">                    FFT trans = <span class="keyword">new</span> FFT(mainWindow.image);</span><br><span class="line">                    BufferedImage[] spec = trans.fct_image(a,b,c,d);</span><br><span class="line">                    label5.setIcon(<span class="keyword">new</span> ImageIcon(spec[<span class="number">1</span>]));</span><br><span class="line">                    Container c1 = frame1.getContentPane();</span><br><span class="line">                    c1.add(label5);</span><br><span class="line">                    frame1.pack();</span><br><span class="line">                    frame1.setVisible(<span class="keyword">true</span>);</span><br><span class="line">                    label6.setIcon(<span class="keyword">new</span> ImageIcon(spec[<span class="number">0</span>]));</span><br><span class="line">                    Container c2 = frame2.getContentPane();</span><br><span class="line">                    c2.add(label6);</span><br><span class="line">                    frame2.pack();</span><br><span class="line">                    frame2.setVisible(<span class="keyword">true</span>);</span><br><span class="line">                    dispose();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        ok.setBounds(<span class="number">60</span>, <span class="number">220</span>, <span class="number">80</span>, <span class="number">30</span>);</span><br><span class="line">        cancle = <span class="keyword">new</span> JButton(<span class="string">"取消"</span>);</span><br><span class="line">        panel.add(cancle);</span><br><span class="line">        cancle.addActionListener(<span class="keyword">new</span> ActionListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">                dispose();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        cancle.setBounds(<span class="number">200</span>, <span class="number">220</span>, <span class="number">80</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        Container c = getContentPane();</span><br><span class="line">        c.setLayout(<span class="keyword">new</span> BoxLayout(c, BoxLayout.Y_AXIS));</span><br><span class="line">        c.add(panel);</span><br><span class="line">        <span class="keyword">this</span>.setVisible(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">this</span>.setLocationRelativeTo(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">this</span>.setSize(<span class="number">380</span>, <span class="number">300</span>);</span><br><span class="line">        <span class="keyword">this</span>.setResizable(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">this</span>.setTitle(<span class="string">"像素采样[x1,x2]-&gt;[y1,y2]"</span>);</span><br><span class="line">        <span class="keyword">this</span>.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setVisible(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="RevokeListener-java-撤销操作"><a href="#RevokeListener-java-撤销操作" class="headerlink" title="RevokeListener.java (撤销操作)"></a>RevokeListener.java (撤销操作)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RevokeListener</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> MainWindow mainWindow;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RevokeListener</span><span class="params">(MainWindow mainWindow)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mainWindow = mainWindow;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">        mainWindow.currPixArray=mainWindow.sourcePixArray;</span><br><span class="line">        mainWindow.showImage(mainWindow.currPixArray);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="blockDCT-java-基于矩阵运算的离散余弦变换"><a href="#blockDCT-java-基于矩阵运算的离散余弦变换" class="headerlink" title="blockDCT.java (基于矩阵运算的离散余弦变换)"></a>blockDCT.java (基于矩阵运算的离散余弦变换)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Jama.Matrix;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">blockDCT</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> QUALITY;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> N = <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">private</span> Matrix C = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[][] Y=&#123;</span><br><span class="line">            &#123;<span class="number">16</span>,<span class="number">11</span>,<span class="number">10</span>,<span class="number">16</span>,<span class="number">24</span>,<span class="number">40</span>,<span class="number">51</span>,<span class="number">61</span>&#125;,</span><br><span class="line">            &#123;<span class="number">12</span>,<span class="number">12</span>,<span class="number">14</span>,<span class="number">19</span>,<span class="number">26</span>,<span class="number">58</span>,<span class="number">60</span>,<span class="number">55</span>&#125;,</span><br><span class="line">            &#123;<span class="number">14</span>,<span class="number">13</span>,<span class="number">16</span>,<span class="number">24</span>,<span class="number">40</span>,<span class="number">57</span>,<span class="number">69</span>,<span class="number">56</span>&#125;,</span><br><span class="line">            &#123;<span class="number">14</span>,<span class="number">17</span>,<span class="number">22</span>,<span class="number">29</span>,<span class="number">51</span>,<span class="number">87</span>,<span class="number">80</span>,<span class="number">62</span>&#125;,</span><br><span class="line">            &#123;<span class="number">18</span>,<span class="number">22</span>,<span class="number">37</span>,<span class="number">56</span>,<span class="number">68</span>,<span class="number">109</span>,<span class="number">103</span>,<span class="number">77</span>&#125;,</span><br><span class="line">            &#123;<span class="number">24</span>,<span class="number">35</span>,<span class="number">55</span>,<span class="number">64</span>,<span class="number">81</span>,<span class="number">104</span>,<span class="number">113</span>,<span class="number">92</span>&#125;,</span><br><span class="line">            &#123;<span class="number">49</span>,<span class="number">64</span>,<span class="number">78</span>,<span class="number">87</span>,<span class="number">103</span>,<span class="number">121</span>,<span class="number">120</span>,<span class="number">101</span>&#125;,</span><br><span class="line">            &#123;<span class="number">72</span>,<span class="number">92</span>,<span class="number">95</span>,<span class="number">98</span>,<span class="number">112</span>,<span class="number">100</span>,<span class="number">103</span>,<span class="number">99</span>&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[][] UV=&#123;</span><br><span class="line">            &#123;<span class="number">17</span>,<span class="number">18</span>,<span class="number">24</span>,<span class="number">47</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>&#125;,</span><br><span class="line">            &#123;<span class="number">18</span>,<span class="number">21</span>,<span class="number">26</span>,<span class="number">66</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>&#125;,</span><br><span class="line">            &#123;<span class="number">24</span>,<span class="number">26</span>,<span class="number">56</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>&#125;,</span><br><span class="line">            &#123;<span class="number">47</span>,<span class="number">66</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>&#125;,</span><br><span class="line">            &#123;<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>&#125;,</span><br><span class="line">            &#123;<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>&#125;,</span><br><span class="line">            &#123;<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>&#125;,</span><br><span class="line">            &#123;<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>,<span class="number">99</span>&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">blockDCT</span><span class="params">(<span class="keyword">int</span> QUALITY)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.QUALITY = QUALITY;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initMatrix</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">double</span> tmp[][] = <span class="keyword">new</span> <span class="keyword">double</span>[N][N];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;N;j++)</span><br><span class="line">            tmp[<span class="number">0</span>][j] = Math.sqrt(<span class="number">1.0</span>/N)*Math.cos((Math.PI*<span class="number">0</span>*(j+<span class="number">0.5</span>))/N);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;N;i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;N;j++)</span><br><span class="line">                tmp[i][j] = Math.sqrt(<span class="number">2.0</span>/N)*Math.cos((Math.PI*i*(j+<span class="number">0.5</span>))/N);</span><br><span class="line">        C = <span class="keyword">new</span> Matrix(tmp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[][][] quantization(<span class="keyword">double</span> inputData[][][]) &#123;</span><br><span class="line">        <span class="keyword">int</span> outputData[][][] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>][N][N];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;N; j++) &#123;</span><br><span class="line">                outputData[<span class="number">0</span>][i][j] = (<span class="keyword">int</span>)Math.round (inputData[<span class="number">0</span>][i][j] / (Y[i][j] * QUALITY/<span class="number">3</span>));</span><br><span class="line">                outputData[<span class="number">1</span>][i][j] = (<span class="keyword">int</span>) Math.round(inputData[<span class="number">1</span>][i][j] / (UV[i][j] * QUALITY/<span class="number">3</span>));</span><br><span class="line">                outputData[<span class="number">2</span>][i][j] = (<span class="keyword">int</span>) Math.round(inputData[<span class="number">2</span>][i][j] / (UV[i][j] * QUALITY/<span class="number">3</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> outputData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span>[][][] deQuantization(<span class="keyword">int</span>[][][] inputData) &#123;</span><br><span class="line">        <span class="keyword">int</span> outputData[][][] = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>][N][N];</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">0</span>; i&lt;N; i++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j=<span class="number">0</span>; j&lt;N; j++) &#123;</span><br><span class="line">                outputData[<span class="number">0</span>][i][j] =  inputData[<span class="number">0</span>][i][j] * (Y[i][j] * QUALITY/<span class="number">3</span>);</span><br><span class="line">                outputData[<span class="number">1</span>][i][j] =  inputData[<span class="number">1</span>][i][j] * (UV[i][j] * QUALITY/<span class="number">3</span>);</span><br><span class="line">                outputData[<span class="number">2</span>][i][j] =  inputData[<span class="number">2</span>][i][j] * (UV[i][j] * QUALITY/<span class="number">3</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> outputData;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">double</span>[][][] dct(<span class="keyword">double</span> input[][][]) &#123;</span><br><span class="line">        <span class="keyword">double</span> output[][][] = <span class="keyword">new</span> <span class="keyword">double</span>[<span class="number">3</span>][N][N];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">            Matrix f = <span class="keyword">new</span> Matrix(input[i]);</span><br><span class="line">            Matrix r = C.times(f).times(C.transpose());</span><br><span class="line">            output[i]=r.getArray();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">double</span>[][][] idct(<span class="keyword">int</span> input[][][]) &#123;</span><br><span class="line">        <span class="keyword">double</span> output[][][] = <span class="keyword">new</span> <span class="keyword">double</span>[<span class="number">3</span>][N][N];</span><br><span class="line">        <span class="keyword">double</span>[][][] dinput = <span class="keyword">new</span> <span class="keyword">double</span>[<span class="number">3</span>][N][N];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;N;j++)</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;N;k++)</span><br><span class="line">                    dinput[i][j][k]=(<span class="keyword">double</span>) input[i][j][k];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)&#123;</span><br><span class="line">            Matrix f = <span class="keyword">new</span> Matrix(dinput[i]);</span><br><span class="line">            Matrix r = C.transpose().times(f).times(C);</span><br><span class="line">            output[i]=r.getArray();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getN</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.N;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Compress-java-基于离散余弦变换的图像压缩算法"><a href="#Compress-java-基于离散余弦变换的图像压缩算法" class="headerlink" title="Compress.java (基于离散余弦变换的图像压缩算法)"></a>Compress.java (基于离散余弦变换的图像压缩算法)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Jama.Matrix;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.awt.image.BufferedImage.TYPE_INT_RGB;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Compress</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> blockDCT dct;</span><br><span class="line">    <span class="keyword">private</span> BufferedImage im;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Compress</span><span class="params">(BufferedImage image,<span class="keyword">int</span> QUALITY)</span> </span>&#123;</span><br><span class="line">        im=image;</span><br><span class="line">        <span class="keyword">this</span>.dct=<span class="keyword">new</span> blockDCT(QUALITY);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BufferedImage <span class="title">compress</span><span class="params">()</span></span>&#123;</span><br><span class="line">        dct.initMatrix();</span><br><span class="line">        <span class="keyword">int</span> rows = im.getWidth();</span><br><span class="line">        <span class="keyword">int</span> columns =im.getHeight();</span><br><span class="line">        <span class="keyword">int</span> row2 = (<span class="keyword">int</span>)Math.ceil(rows/(dct.getN()*<span class="number">1.0</span>))*dct.getN();</span><br><span class="line">        <span class="keyword">int</span> column2 = (<span class="keyword">int</span>)Math.ceil(columns/(dct.getN()*<span class="number">1.0</span>))*dct.getN();</span><br><span class="line">        <span class="keyword">int</span>[][][] pixels;</span><br><span class="line">        <span class="keyword">int</span>[][][] pixel2 = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>][row2][column2];</span><br><span class="line">        <span class="keyword">double</span>[][][] databuffer = <span class="keyword">new</span> <span class="keyword">double</span>[<span class="number">3</span>][dct.getN()][dct.getN()];</span><br><span class="line">        <span class="keyword">double</span>[][][] temp;</span><br><span class="line">        <span class="keyword">int</span>[][][]  output= <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>][row2][column2];</span><br><span class="line">        <span class="keyword">int</span>[][][] quantizedOutput;</span><br><span class="line">        <span class="keyword">int</span>[][][] dequantized;</span><br><span class="line">        <span class="keyword">double</span>[][][] recovered;</span><br><span class="line">        BufferedImage imageOutput = <span class="keyword">new</span> BufferedImage(rows, columns, TYPE_INT_RGB);</span><br><span class="line">        pixels = FFT.imgToMatrix(im,rows,columns,<span class="keyword">false</span>,<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> a=<span class="number">0</span>;a&lt;<span class="number">3</span>;a++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rows; i++)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; columns; j++)</span><br><span class="line">                    pixel2[a][i][j]=pixels[a][i][j]-<span class="number">128</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> a=<span class="number">0</span>;a&lt;<span class="number">3</span>;a++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; row2; i=(i+dct.getN())) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; column2; j=(j+dct.getN())) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; dct.getN(); k++) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">0</span>; l &lt; dct.getN(); l++) &#123;</span><br><span class="line">                            databuffer[a][k][l] = (<span class="keyword">double</span>) pixel2[a][(k+i)][(j+l)];</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    temp = dct.dct(databuffer);</span><br><span class="line">                    quantizedOutput = dct.quantization(temp);</span><br><span class="line">                    dequantized = dct.deQuantization(quantizedOutput);</span><br><span class="line">                    recovered = dct.idct(dequantized);</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; dct.getN(); k++) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">0</span>; l &lt; dct.getN(); l++) &#123;</span><br><span class="line">                            output[a][(k+i)][(j+l)] = (<span class="keyword">int</span>)recovered[a][(k)][(l)]+<span class="number">128</span>;</span><br><span class="line">                            <span class="keyword">if</span>(output[a][(k+i)][(j+l)]&gt;<span class="number">255</span>)output[a][(k+i)][(j+l)]=<span class="number">255</span>;</span><br><span class="line">                            <span class="keyword">if</span>(output[a][(k+i)][(j+l)]&lt;<span class="number">0</span>)output[a][(k+i)][(j+l)]=<span class="number">0</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rows; i++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; columns; j++) &#123;</span><br><span class="line">                <span class="keyword">int</span> R = (<span class="keyword">int</span>)(output[<span class="number">0</span>][i][j]+<span class="number">1.402</span>*(output[<span class="number">2</span>][i][j]-<span class="number">128</span>));</span><br><span class="line">                <span class="keyword">int</span> G = (<span class="keyword">int</span>)(output[<span class="number">0</span>][i][j]-<span class="number">0.34414</span>*(output[<span class="number">1</span>][i][j]-<span class="number">128</span>)-<span class="number">0.71414</span>*(output[<span class="number">2</span>][i][j]-<span class="number">128</span>));</span><br><span class="line">                <span class="keyword">int</span> B = (<span class="keyword">int</span>)(output[<span class="number">0</span>][i][j]+<span class="number">1.772</span>*(output[<span class="number">1</span>][i][j]-<span class="number">128</span>));</span><br><span class="line">                <span class="keyword">if</span>(R&gt;<span class="number">255</span>)R=<span class="number">255</span>;<span class="keyword">if</span>(R&lt;<span class="number">0</span>)R=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span>(G&gt;<span class="number">255</span>)G=<span class="number">255</span>;<span class="keyword">if</span>(G&lt;<span class="number">0</span>)G=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span>(B&gt;<span class="number">255</span>)B=<span class="number">255</span>;<span class="keyword">if</span>(B&lt;<span class="number">0</span>)B=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">int</span> rgb=Math.round((R * <span class="number">256</span> + G) * <span class="number">256</span> + B);</span><br><span class="line">                imageOutput.setRGB(i, j,rgb);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> imageOutput;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="compressListener-java-基于离散余弦变换的图像压缩应用"><a href="#compressListener-java-基于离散余弦变换的图像压缩应用" class="headerlink" title="compressListener.java (基于离散余弦变换的图像压缩应用)"></a>compressListener.java (基于离散余弦变换的图像压缩应用)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.event.ChangeEvent;</span><br><span class="line"><span class="keyword">import</span> javax.swing.event.ChangeListener;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.text.DecimalFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">compressListener</span> <span class="keyword">extends</span> <span class="title">JFrame</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> MainWindow mainWindow;</span><br><span class="line">    <span class="keyword">private</span> JSlider slider1;</span><br><span class="line">    <span class="keyword">private</span> JLabel label1;</span><br><span class="line">    <span class="keyword">private</span> JButton ok= <span class="keyword">new</span> JButton(<span class="string">"确定"</span>);</span><br><span class="line">    <span class="keyword">private</span> JButton cancle=<span class="keyword">new</span> JButton(<span class="string">"取消"</span>);</span><br><span class="line">    <span class="keyword">private</span> JRadioButton PNG = <span class="keyword">new</span> JRadioButton(<span class="string">"png"</span>);</span><br><span class="line">    <span class="keyword">private</span> JLabel png = <span class="keyword">new</span> JLabel(<span class="string">"PNG"</span>);</span><br><span class="line">    <span class="keyword">private</span> JRadioButton JPG = <span class="keyword">new</span> JRadioButton(<span class="string">"jpg"</span>);</span><br><span class="line">    <span class="keyword">private</span> JLabel jpg = <span class="keyword">new</span> JLabel(<span class="string">"JPG"</span>);</span><br><span class="line">    <span class="keyword">private</span> JRadioButton BMP = <span class="keyword">new</span> JRadioButton(<span class="string">"bmp"</span>);</span><br><span class="line">    <span class="keyword">private</span> JLabel bmp = <span class="keyword">new</span> JLabel(<span class="string">"BMP"</span>);</span><br><span class="line">    <span class="keyword">private</span> JRadioButton GIF = <span class="keyword">new</span> JRadioButton(<span class="string">"gif"</span>);</span><br><span class="line">    <span class="keyword">private</span> JLabel gif = <span class="keyword">new</span> JLabel(<span class="string">"GIF"</span>);</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> a;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">compressListener</span><span class="params">(MainWindow mainWindow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mainWindow = mainWindow;</span><br><span class="line">        JPanel panel = <span class="keyword">new</span> JPanel();</span><br><span class="line">        panel.setLayout(<span class="keyword">null</span>);</span><br><span class="line">        slider1 = <span class="keyword">new</span> JSlider(<span class="number">1</span>, <span class="number">10</span>,<span class="number">1</span>);</span><br><span class="line">        label1 = <span class="keyword">new</span> JLabel(<span class="string">"1"</span>);</span><br><span class="line">        panel.add(slider1);</span><br><span class="line">        slider1.setBounds(<span class="number">30</span>, <span class="number">30</span>, <span class="number">270</span>, <span class="number">40</span>);</span><br><span class="line">        panel.add(label1);</span><br><span class="line">        label1.setBounds(<span class="number">310</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">40</span>);</span><br><span class="line"></span><br><span class="line">        slider1.addChangeListener(<span class="keyword">new</span> ChangeListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stateChanged</span><span class="params">(ChangeEvent e)</span> </span>&#123;</span><br><span class="line">                label1.setText(String.valueOf(slider1.getValue()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        panel.add(PNG);</span><br><span class="line">        PNG.setBounds(<span class="number">30</span>, <span class="number">60</span>, <span class="number">20</span>, <span class="number">40</span>);</span><br><span class="line">        panel.add(png);</span><br><span class="line">        png.setBounds(<span class="number">50</span>, <span class="number">60</span>, <span class="number">50</span>, <span class="number">40</span>);</span><br><span class="line">        panel.add(BMP);</span><br><span class="line">        BMP.setBounds(<span class="number">90</span>, <span class="number">60</span>, <span class="number">20</span>, <span class="number">40</span>);</span><br><span class="line">        panel.add(bmp);</span><br><span class="line">        bmp.setBounds(<span class="number">110</span>, <span class="number">60</span>, <span class="number">50</span>, <span class="number">40</span>);</span><br><span class="line">        panel.add(JPG);</span><br><span class="line">        JPG.setBounds(<span class="number">150</span>, <span class="number">60</span>, <span class="number">20</span>, <span class="number">40</span>);</span><br><span class="line">        panel.add(jpg);</span><br><span class="line">        jpg.setBounds(<span class="number">170</span>, <span class="number">60</span>, <span class="number">50</span>, <span class="number">40</span>);</span><br><span class="line">        panel.add(GIF);</span><br><span class="line">        GIF.setBounds(<span class="number">210</span>, <span class="number">60</span>, <span class="number">20</span>, <span class="number">40</span>);</span><br><span class="line">        panel.add(gif);</span><br><span class="line">        gif.setBounds(<span class="number">230</span>, <span class="number">60</span>, <span class="number">50</span>, <span class="number">40</span>);</span><br><span class="line">        ButtonGroup group = <span class="keyword">new</span> ButtonGroup();<span class="comment">// 创建单选按钮组</span></span><br><span class="line">        group.add(PNG);</span><br><span class="line">        group.add(BMP);</span><br><span class="line">        group.add(JPG);</span><br><span class="line">        group.add(GIF);</span><br><span class="line">        PNG.setSelected(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        panel.add(ok);</span><br><span class="line">        ok.addActionListener(<span class="keyword">new</span> ActionListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (mainWindow.image != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    a = slider1.getValue();</span><br><span class="line">                    <span class="keyword">if</span>(PNG.isSelected())</span><br><span class="line">                        type=<span class="string">"png"</span>;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>(BMP.isSelected())</span><br><span class="line">                        type=<span class="string">"bmp"</span>;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>(GIF.isSelected())</span><br><span class="line">                        type=<span class="string">"gif"</span>;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        type=<span class="string">"jpg"</span>;</span><br><span class="line"></span><br><span class="line">                    JFrame frame2 = <span class="keyword">new</span> JFrame();</span><br><span class="line">                    JLabel label2 = <span class="keyword">new</span> JLabel();</span><br><span class="line">                    Compress trans = <span class="keyword">new</span> Compress(mainWindow.image,a);</span><br><span class="line">                    BufferedImage spec = trans.compress();</span><br><span class="line">                    label2.setIcon(<span class="keyword">new</span> ImageIcon(spec));</span><br><span class="line">                    File outputfile = <span class="keyword">new</span> File(<span class="string">"cache."</span>+type);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        ImageIO.write(spec, type, outputfile);</span><br><span class="line">                    &#125;<span class="keyword">catch</span> (Exception ee)&#123;&#125;</span><br><span class="line">                    File picture = <span class="keyword">new</span> File(<span class="string">"cache."</span>+type);</span><br><span class="line">                    DecimalFormat df = <span class="keyword">new</span> DecimalFormat(<span class="string">"#.00"</span>);</span><br><span class="line">                    String size = df.format(picture.length()/<span class="number">1024.0</span>);</span><br><span class="line">                    Container c2 = frame2.getContentPane();</span><br><span class="line">                    c2.add(label2);</span><br><span class="line">                    frame2.pack();</span><br><span class="line">                    frame2.setTitle(<span class="string">"压缩后图像 QUALITY="</span>+String.valueOf(a)+<span class="string">"  SIZE="</span>+size);</span><br><span class="line"><span class="comment">//                        picture.delete();</span></span><br><span class="line">                    frame2.setVisible(<span class="keyword">true</span>);</span><br><span class="line">                    a = slider1.getValue();</span><br><span class="line">                    dispose();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        ok.setBounds(<span class="number">60</span>, <span class="number">120</span>, <span class="number">80</span>, <span class="number">30</span>);</span><br><span class="line">        panel.add(cancle);</span><br><span class="line">        cancle.addActionListener(<span class="keyword">new</span> ActionListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">                dispose();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        cancle.setBounds(<span class="number">200</span>, <span class="number">120</span>, <span class="number">80</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        Container c = getContentPane();</span><br><span class="line">        c.setLayout(<span class="keyword">new</span> BoxLayout(c, BoxLayout.Y_AXIS));</span><br><span class="line">        c.add(panel);</span><br><span class="line">        <span class="keyword">this</span>.setVisible(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">this</span>.setLocationRelativeTo(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">this</span>.setSize(<span class="number">380</span>, <span class="number">200</span>);</span><br><span class="line">        <span class="keyword">this</span>.setResizable(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">this</span>.setTitle(<span class="string">"量化参数Q"</span>);</span><br><span class="line">        <span class="keyword">this</span>.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mainWindow.image != <span class="keyword">null</span>)</span><br><span class="line">            ok.setEnabled(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            ok.setEnabled(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">this</span>.setVisible(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="waterMark-java-水印嵌入与提取算法"><a href="#waterMark-java-水印嵌入与提取算法" class="headerlink" title="waterMark.java (水印嵌入与提取算法)"></a>waterMark.java (水印嵌入与提取算法)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Jama.Matrix;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.awt.image.BufferedImage.TYPE_INT_RGB;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">waterMark</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> blockDCT dct = <span class="keyword">new</span> blockDCT(<span class="number">8</span>);</span><br><span class="line">    <span class="keyword">private</span> BufferedImage watermark;</span><br><span class="line">    <span class="keyword">private</span> BufferedImage carrier;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> nwidth,nheight;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> alpha;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[][][] waterRecover;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">waterMark</span><span class="params">(BufferedImage carrier,<span class="keyword">double</span> alpha,BufferedImage water)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.alpha = alpha;</span><br><span class="line">        <span class="keyword">this</span>.carrier = carrier;</span><br><span class="line">        <span class="keyword">this</span>.watermark = water;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">waterMark</span><span class="params">(BufferedImage carrier,<span class="keyword">double</span> alpha,<span class="keyword">int</span> nwidth,<span class="keyword">int</span> nheight)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.carrier = carrier;</span><br><span class="line">        <span class="keyword">this</span>.alpha = alpha;</span><br><span class="line">        <span class="keyword">this</span>.nwidth = nwidth;</span><br><span class="line">        <span class="keyword">this</span>.nheight = nheight;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">double</span>[] feeddback()&#123;</span><br><span class="line">        <span class="keyword">double</span>[] res = <span class="keyword">new</span> <span class="keyword">double</span>[<span class="number">3</span>];</span><br><span class="line">        res[<span class="number">0</span>]=alpha;</span><br><span class="line">        res[<span class="number">1</span>]=nwidth;</span><br><span class="line">        res[<span class="number">2</span>]=nheight;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[][][] getExpandCarry(<span class="keyword">int</span> w1,<span class="keyword">int</span> h1)&#123;</span><br><span class="line">        <span class="keyword">int</span>[][][] carryPix = FFT.imgToMatrix(carrier,carrier.getWidth(),carrier.getHeight(),<span class="keyword">false</span>,<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">int</span>[][][] carryArr = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>][w1][h1];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> a=<span class="number">0</span>;a&lt;<span class="number">3</span>;a++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; carrier.getWidth(); i++)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; carrier.getHeight(); j++)</span><br><span class="line">                    carryArr[a][i][j]=carryPix[a][i][j]-<span class="number">128</span>;</span><br><span class="line">        <span class="keyword">return</span> carryArr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[][][] getExpandwater(<span class="keyword">int</span> w1,<span class="keyword">int</span> h1)&#123;</span><br><span class="line">        <span class="keyword">int</span>[][][] waterPix = FFT.imgToMatrix(watermark,watermark.getWidth(),watermark.getHeight(),<span class="keyword">false</span>,<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">int</span> w = (<span class="keyword">int</span>)Math.ceil((watermark.getWidth()+<span class="number">0.0</span>)/(w1/dct.getN()))*(w1/dct.getN());</span><br><span class="line">        <span class="keyword">int</span> h = (<span class="keyword">int</span>)Math.ceil((watermark.getHeight()+<span class="number">0.0</span>)/(h1/dct.getN()))*(h1/dct.getN());</span><br><span class="line">        <span class="keyword">int</span>[][][] waterArr = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>][w][h];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> a=<span class="number">0</span>;a&lt;<span class="number">3</span>;a++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; watermark.getWidth(); i++)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; watermark.getHeight(); j++)</span><br><span class="line">                    waterArr[a][i][j]=waterPix[a][i][j];</span><br><span class="line">        <span class="keyword">this</span>.nwidth = (w/(w1/dct.getN()));</span><br><span class="line">        <span class="keyword">this</span>.nheight = (h/(h1/dct.getN()));</span><br><span class="line">        <span class="keyword">return</span> waterArr;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span>[][][] doubleToInt(<span class="keyword">double</span>[][][] a)&#123;</span><br><span class="line">        <span class="keyword">int</span>[][][] res = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>][a[<span class="number">0</span>].length][a[<span class="number">0</span>][<span class="number">0</span>].length];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;<span class="number">3</span>;i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;a[<span class="number">0</span>].length;j++)</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;a[<span class="number">0</span>][<span class="number">0</span>].length;k++)</span><br><span class="line">                    res[i][j][k] = (<span class="keyword">int</span>)a[i][j][k];</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span>[][][] addWater(<span class="keyword">double</span>[][][] carry,<span class="keyword">int</span>[][][] water,<span class="keyword">int</span> count)&#123;</span><br><span class="line">        <span class="keyword">double</span>[][][] res = carry.clone();</span><br><span class="line">        <span class="keyword">int</span> wnum = water[<span class="number">0</span>].length/nwidth;</span><br><span class="line">        <span class="keyword">int</span> h = ((count-<span class="number">1</span>)/wnum)*nheight;</span><br><span class="line">        <span class="keyword">int</span> w = ((count-h/nheight*wnum)-((count-h/nheight*wnum)/(wnum+<span class="number">1</span>))*wnum-<span class="number">1</span>)*nwidth;</span><br><span class="line">        <span class="keyword">int</span>[] buffer = <span class="keyword">new</span> <span class="keyword">int</span>[nwidth*nheight];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> a=<span class="number">0</span>;a&lt;<span class="number">3</span>;a++) &#123;</span><br><span class="line">            <span class="keyword">int</span> c = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = w; i &lt; w + nwidth; i++)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = h; j &lt; h + nheight; j++) &#123;</span><br><span class="line">                    buffer[c] = water[a][i][j];</span><br><span class="line">                    c++;</span><br><span class="line">                &#125;</span><br><span class="line">            c=<span class="number">0</span>;</span><br><span class="line">            loop:<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;dct.getN();i++)</span><br><span class="line">                <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;dct.getN();j++)&#123;</span><br><span class="line">                    <span class="keyword">if</span>(i+j&gt;=<span class="number">3</span> &amp;&amp; i+j&lt;=<span class="number">5</span>) &#123;</span><br><span class="line">                        res[a][i][j] = alpha*(buffer[c]-<span class="number">128</span>);</span><br><span class="line">                        c++;</span><br><span class="line">                        <span class="keyword">if</span>(c==buffer.length)<span class="keyword">break</span> loop;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">minusWater</span><span class="params">(<span class="keyword">double</span>[][][] carry,<span class="keyword">int</span> count,<span class="keyword">int</span> a)</span></span>&#123;</span><br><span class="line">        <span class="keyword">double</span>[][][] res = carry.clone();</span><br><span class="line">        <span class="keyword">int</span> wnum = waterRecover[<span class="number">0</span>].length/nwidth;</span><br><span class="line">        <span class="keyword">int</span> h = ((count-<span class="number">1</span>)/wnum)*nheight;</span><br><span class="line">        <span class="keyword">int</span> w = ((count-h/nheight*wnum)-((count-h/nheight*wnum)/(wnum+<span class="number">1</span>))*wnum-<span class="number">1</span>)*nwidth;</span><br><span class="line">        <span class="keyword">double</span>[] buffer = <span class="keyword">new</span> <span class="keyword">double</span>[nwidth*nheight];</span><br><span class="line">        <span class="keyword">int</span> c = <span class="number">0</span>;</span><br><span class="line">        loop:<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;dct.getN();i++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;dct.getN();j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(i+j&gt;=<span class="number">3</span> &amp;&amp; i+j&lt;=<span class="number">5</span>) &#123;</span><br><span class="line">                    buffer[c] = carry[a][i][j]/alpha+<span class="number">128</span>;</span><br><span class="line">                    c++;</span><br><span class="line">                    <span class="keyword">if</span>(c==buffer.length)<span class="keyword">break</span> loop;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        c=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = w; i &lt; w + nwidth; i++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = h; j &lt; h + nheight; j++) &#123;</span><br><span class="line">                waterRecover[a][i][j] = (<span class="keyword">int</span>)buffer[c];</span><br><span class="line">                c++;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BufferedImage <span class="title">insert</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> rows = carrier.getWidth();</span><br><span class="line">        <span class="keyword">int</span> columns =carrier.getHeight();</span><br><span class="line">        <span class="keyword">int</span> row2 = (<span class="keyword">int</span>)Math.ceil(rows/(dct.getN()*<span class="number">1.0</span>))*dct.getN();</span><br><span class="line">        <span class="keyword">int</span> column2 = (<span class="keyword">int</span>)Math.ceil(columns/(dct.getN()*<span class="number">1.0</span>))*dct.getN();</span><br><span class="line">        <span class="keyword">double</span>[][][] databuffer = <span class="keyword">new</span> <span class="keyword">double</span>[<span class="number">3</span>][dct.getN()][dct.getN()];</span><br><span class="line">        <span class="keyword">double</span>[][][] temp;</span><br><span class="line">        <span class="keyword">double</span>[][][] temp2;</span><br><span class="line">        <span class="keyword">int</span>[][][] temp3;</span><br><span class="line">        <span class="keyword">int</span>[][][]  output= <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>][row2][column2];</span><br><span class="line">        <span class="keyword">double</span>[][][] recovered;</span><br><span class="line">        dct.initMatrix();</span><br><span class="line">        BufferedImage imageOutput = <span class="keyword">new</span> BufferedImage(rows, columns, TYPE_INT_RGB);</span><br><span class="line">        <span class="keyword">int</span>[][][] carryArr = getExpandCarry(row2,column2);</span><br><span class="line">        <span class="keyword">int</span>[][][] waterArr = getExpandwater(row2,column2);</span><br><span class="line">        <span class="keyword">int</span> count=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> a=<span class="number">0</span>;a&lt;<span class="number">3</span>;a++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; row2; i = (i + dct.getN())) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; column2; j = (j + dct.getN())) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; dct.getN(); k++) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">0</span>; l &lt; dct.getN(); l++) &#123;</span><br><span class="line">                            databuffer[a][k][l] = (<span class="keyword">double</span>) carryArr[a][(k + i)][(j + l)];</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    temp = dct.dct(databuffer);</span><br><span class="line">                    temp2 = addWater(temp, waterArr, count);</span><br><span class="line">                    count++;</span><br><span class="line">                    temp3 = doubleToInt(temp2);</span><br><span class="line">                    recovered = dct.idct(temp3);</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; dct.getN(); k++) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">0</span>; l &lt; dct.getN(); l++) &#123;</span><br><span class="line">                            output[a][(k + i)][(j + l)] = (<span class="keyword">int</span>) recovered[a][(k)][(l)] + <span class="number">128</span>;</span><br><span class="line">                            <span class="keyword">if</span> (output[a][(k + i)][(j + l)] &gt; <span class="number">255</span>) output[a][(k + i)][(j + l)] = <span class="number">255</span>;</span><br><span class="line">                            <span class="keyword">if</span> (output[a][(k + i)][(j + l)] &lt; <span class="number">0</span>) output[a][(k + i)][(j + l)] = <span class="number">0</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            count=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; rows; i++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; columns; j++) &#123;</span><br><span class="line">                <span class="keyword">int</span> R = (<span class="keyword">int</span>)output[<span class="number">0</span>][i][j];</span><br><span class="line">                <span class="keyword">int</span> G = (<span class="keyword">int</span>)output[<span class="number">1</span>][i][j];</span><br><span class="line">                <span class="keyword">int</span> B = (<span class="keyword">int</span>)output[<span class="number">2</span>][i][j];</span><br><span class="line">                <span class="keyword">if</span>(R&gt;<span class="number">255</span>)R=<span class="number">255</span>;<span class="keyword">if</span>(R&lt;<span class="number">0</span>)R=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span>(G&gt;<span class="number">255</span>)G=<span class="number">255</span>;<span class="keyword">if</span>(G&lt;<span class="number">0</span>)G=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span>(B&gt;<span class="number">255</span>)B=<span class="number">255</span>;<span class="keyword">if</span>(B&lt;<span class="number">0</span>)B=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">int</span> rgb=Math.round((R * <span class="number">256</span> + G) * <span class="number">256</span> + B);</span><br><span class="line">                imageOutput.setRGB(i, j,rgb);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> imageOutput;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BufferedImage <span class="title">extract</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> rows = carrier.getWidth();</span><br><span class="line">        <span class="keyword">int</span> columns =carrier.getHeight();</span><br><span class="line">        <span class="keyword">int</span> row2 = (<span class="keyword">int</span>)Math.ceil(rows/(dct.getN()*<span class="number">1.0</span>))*dct.getN();</span><br><span class="line">        <span class="keyword">int</span> column2 = (<span class="keyword">int</span>)Math.ceil(columns/(dct.getN()*<span class="number">1.0</span>))*dct.getN();</span><br><span class="line">        <span class="keyword">int</span> waterW = row2/dct.getN()*nwidth;</span><br><span class="line">        <span class="keyword">int</span> waterH = column2/dct.getN()*nheight;</span><br><span class="line">        waterRecover = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>][waterW][waterH];</span><br><span class="line">        <span class="keyword">double</span>[][][] databuffer = <span class="keyword">new</span> <span class="keyword">double</span>[<span class="number">3</span>][dct.getN()][dct.getN()];</span><br><span class="line">        <span class="keyword">double</span>[][][] temp;</span><br><span class="line">        dct.initMatrix();</span><br><span class="line">        BufferedImage imageOutput = <span class="keyword">new</span> BufferedImage(waterW, waterH, TYPE_INT_RGB);</span><br><span class="line">        <span class="keyword">int</span>[][][] carryArr = getExpandCarry(row2,column2);</span><br><span class="line">        <span class="keyword">int</span> count=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> a=<span class="number">0</span>;a&lt;<span class="number">3</span>;a++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; row2; i = (i + dct.getN())) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; column2; j = (j + dct.getN())) &#123;</span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; dct.getN(); k++) &#123;</span><br><span class="line">                        <span class="keyword">for</span> (<span class="keyword">int</span> l = <span class="number">0</span>; l &lt; dct.getN(); l++) &#123;</span><br><span class="line">                            databuffer[a][k][l] = (<span class="keyword">double</span>) carryArr[a][(k + i)][(j + l)];</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    temp = dct.dct(databuffer);</span><br><span class="line">                    minusWater(temp, count, a);</span><br><span class="line">                    count++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            count=<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; waterW; i++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; waterH; j++) &#123;</span><br><span class="line">                <span class="keyword">int</span> R = waterRecover[<span class="number">0</span>][i][j];</span><br><span class="line">                <span class="keyword">int</span> G = waterRecover[<span class="number">1</span>][i][j];</span><br><span class="line">                <span class="keyword">int</span> B = waterRecover[<span class="number">2</span>][i][j];</span><br><span class="line">                <span class="keyword">if</span>(R&gt;<span class="number">255</span>)R=<span class="number">255</span>;<span class="keyword">if</span>(R&lt;<span class="number">0</span>)R=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span>(G&gt;<span class="number">255</span>)G=<span class="number">255</span>;<span class="keyword">if</span>(G&lt;<span class="number">0</span>)G=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">if</span>(B&gt;<span class="number">255</span>)B=<span class="number">255</span>;<span class="keyword">if</span>(B&lt;<span class="number">0</span>)B=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">int</span> rgb=Math.round((R * <span class="number">256</span> + G) * <span class="number">256</span> + B);</span><br><span class="line">                imageOutput.setRGB(i, j,rgb);</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> imageOutput;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="watermarkListener-java-水印嵌入应用"><a href="#watermarkListener-java-水印嵌入应用" class="headerlink" title="watermarkListener.java (水印嵌入应用)"></a>watermarkListener.java (水印嵌入应用)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.event.ChangeEvent;</span><br><span class="line"><span class="keyword">import</span> javax.swing.event.ChangeListener;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.PixelGrabber;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.text.DecimalFormat;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">watermarkListener</span> <span class="keyword">extends</span> <span class="title">JFrame</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> MainWindow mainWindow;</span><br><span class="line">    <span class="keyword">private</span> JSlider slider1;</span><br><span class="line">    <span class="keyword">private</span> JLabel label1;</span><br><span class="line">    <span class="keyword">private</span> JButton ok= <span class="keyword">new</span> JButton(<span class="string">"确定"</span>);</span><br><span class="line">    <span class="keyword">private</span> JButton cancle=<span class="keyword">new</span> JButton(<span class="string">"取消"</span>);</span><br><span class="line">    <span class="keyword">private</span> JRadioButton PNG = <span class="keyword">new</span> JRadioButton(<span class="string">"png"</span>);</span><br><span class="line">    <span class="keyword">private</span> JLabel png = <span class="keyword">new</span> JLabel(<span class="string">"PNG"</span>);</span><br><span class="line">    <span class="keyword">private</span> JRadioButton JPG = <span class="keyword">new</span> JRadioButton(<span class="string">"jpg"</span>);</span><br><span class="line">    <span class="keyword">private</span> JLabel jpg = <span class="keyword">new</span> JLabel(<span class="string">"JPG"</span>);</span><br><span class="line">    <span class="keyword">private</span> JRadioButton BMP = <span class="keyword">new</span> JRadioButton(<span class="string">"bmp"</span>);</span><br><span class="line">    <span class="keyword">private</span> JLabel bmp = <span class="keyword">new</span> JLabel(<span class="string">"BMP"</span>);</span><br><span class="line">    <span class="keyword">private</span> JRadioButton GIF = <span class="keyword">new</span> JRadioButton(<span class="string">"gif"</span>);</span><br><span class="line">    <span class="keyword">private</span> JLabel gif = <span class="keyword">new</span> JLabel(<span class="string">"GIF"</span>);</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> BufferedImage water;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">watermarkListener</span><span class="params">(MainWindow mainWindow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mainWindow = mainWindow;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        JPanel panel = <span class="keyword">new</span> JPanel();</span><br><span class="line">        panel.setLayout(<span class="keyword">null</span>);</span><br><span class="line">        slider1 = <span class="keyword">new</span> JSlider(<span class="number">1</span>, <span class="number">100</span>,<span class="number">1</span>);</span><br><span class="line">        label1 = <span class="keyword">new</span> JLabel(<span class="string">"0.01"</span>);</span><br><span class="line">        panel.add(slider1);</span><br><span class="line">        slider1.setBounds(<span class="number">30</span>, <span class="number">30</span>, <span class="number">270</span>, <span class="number">40</span>);</span><br><span class="line">        panel.add(label1);</span><br><span class="line">        label1.setBounds(<span class="number">310</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">40</span>);</span><br><span class="line"></span><br><span class="line">        slider1.addChangeListener(<span class="keyword">new</span> ChangeListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stateChanged</span><span class="params">(ChangeEvent e)</span> </span>&#123;</span><br><span class="line">                label1.setText(String.valueOf(slider1.getValue()/<span class="number">100.0</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        panel.add(PNG);</span><br><span class="line">        PNG.setBounds(<span class="number">30</span>, <span class="number">60</span>, <span class="number">20</span>, <span class="number">40</span>);</span><br><span class="line">        panel.add(png);</span><br><span class="line">        png.setBounds(<span class="number">50</span>, <span class="number">60</span>, <span class="number">50</span>, <span class="number">40</span>);</span><br><span class="line">        panel.add(BMP);</span><br><span class="line">        BMP.setBounds(<span class="number">90</span>, <span class="number">60</span>, <span class="number">20</span>, <span class="number">40</span>);</span><br><span class="line">        panel.add(bmp);</span><br><span class="line">        bmp.setBounds(<span class="number">110</span>, <span class="number">60</span>, <span class="number">50</span>, <span class="number">40</span>);</span><br><span class="line">        panel.add(JPG);</span><br><span class="line">        JPG.setBounds(<span class="number">150</span>, <span class="number">60</span>, <span class="number">20</span>, <span class="number">40</span>);</span><br><span class="line">        panel.add(jpg);</span><br><span class="line">        jpg.setBounds(<span class="number">170</span>, <span class="number">60</span>, <span class="number">50</span>, <span class="number">40</span>);</span><br><span class="line">        panel.add(GIF);</span><br><span class="line">        GIF.setBounds(<span class="number">210</span>, <span class="number">60</span>, <span class="number">20</span>, <span class="number">40</span>);</span><br><span class="line">        panel.add(gif);</span><br><span class="line">        gif.setBounds(<span class="number">230</span>, <span class="number">60</span>, <span class="number">50</span>, <span class="number">40</span>);</span><br><span class="line">        ButtonGroup group = <span class="keyword">new</span> ButtonGroup();<span class="comment">// 创建单选按钮组</span></span><br><span class="line">        group.add(PNG);</span><br><span class="line">        group.add(BMP);</span><br><span class="line">        group.add(JPG);</span><br><span class="line">        group.add(GIF);</span><br><span class="line">        PNG.setSelected(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">        panel.add(ok);</span><br><span class="line">        ok.addActionListener(<span class="keyword">new</span> ActionListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span> (mainWindow.image != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(PNG.isSelected())</span><br><span class="line">                        type=<span class="string">"png"</span>;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>(BMP.isSelected())</span><br><span class="line">                        type=<span class="string">"bmp"</span>;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>(GIF.isSelected())</span><br><span class="line">                        type=<span class="string">"gif"</span>;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        type=<span class="string">"jpg"</span>;</span><br><span class="line"></span><br><span class="line">                    JFrame frame2 = <span class="keyword">new</span> JFrame();</span><br><span class="line">                    JLabel label2 = <span class="keyword">new</span> JLabel();</span><br><span class="line">                    waterMark trans = <span class="keyword">new</span> waterMark(mainWindow.image,slider1.getValue()/<span class="number">100.0</span>,water);</span><br><span class="line">                    BufferedImage spec = trans.insert();</span><br><span class="line">                    label2.setIcon(<span class="keyword">new</span> ImageIcon(spec));</span><br><span class="line">                    File outputfile = <span class="keyword">new</span> File(<span class="string">"water."</span>+type);</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        ImageIO.write(spec, type, outputfile);</span><br><span class="line">                    &#125;<span class="keyword">catch</span> (Exception ee)&#123;&#125;</span><br><span class="line">                    Container c2 = frame2.getContentPane();</span><br><span class="line">                    c2.add(label2);</span><br><span class="line">                    frame2.pack();</span><br><span class="line">                    <span class="keyword">double</span>[] back = trans.feeddback();</span><br><span class="line">                    frame2.setTitle(<span class="string">"水印嵌入完成 alpha="</span>+back[<span class="number">0</span>]+<span class="string">" W="</span>+back[<span class="number">1</span>]+<span class="string">" H="</span>+back[<span class="number">2</span>]);</span><br><span class="line"><span class="comment">//                        picture.delete();</span></span><br><span class="line">                    frame2.setVisible(<span class="keyword">true</span>);</span><br><span class="line">                    dispose();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        ok.setBounds(<span class="number">60</span>, <span class="number">120</span>, <span class="number">80</span>, <span class="number">30</span>);</span><br><span class="line">        panel.add(cancle);</span><br><span class="line">        cancle.addActionListener(<span class="keyword">new</span> ActionListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">                dispose();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        cancle.setBounds(<span class="number">200</span>, <span class="number">120</span>, <span class="number">80</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        Container c = getContentPane();</span><br><span class="line">        c.setLayout(<span class="keyword">new</span> BoxLayout(c, BoxLayout.Y_AXIS));</span><br><span class="line">        c.add(panel);</span><br><span class="line">        <span class="keyword">this</span>.setVisible(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">this</span>.setLocationRelativeTo(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">this</span>.setSize(<span class="number">380</span>, <span class="number">200</span>);</span><br><span class="line">        <span class="keyword">this</span>.setResizable(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">this</span>.setTitle(<span class="string">"水印嵌入参数 alpha"</span>);</span><br><span class="line">        <span class="keyword">this</span>.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (mainWindow.image != <span class="keyword">null</span>)</span><br><span class="line">            ok.setEnabled(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            ok.setEnabled(<span class="keyword">false</span>);</span><br><span class="line">        JFileChooser file = <span class="keyword">new</span> JFileChooser();</span><br><span class="line">        String filePath;</span><br><span class="line">        <span class="keyword">int</span> feedback = file.showOpenDialog(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">if</span> (feedback == JFileChooser.APPROVE_OPTION) &#123;</span><br><span class="line">            File target = file.getSelectedFile();</span><br><span class="line">            <span class="keyword">if</span> (target != <span class="keyword">null</span>) &#123;</span><br><span class="line">                filePath = target.getAbsolutePath();</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    water = ImageIO.read(<span class="keyword">new</span> File(filePath));</span><br><span class="line">                    PixelGrabber p;</span><br><span class="line">                    <span class="keyword">int</span>[] array = <span class="keyword">new</span> <span class="keyword">int</span>[water.getWidth() * water.getHeight()];</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        p = <span class="keyword">new</span> PixelGrabber(water, <span class="number">0</span>, <span class="number">0</span>, water.getWidth(), water.getHeight(), array, <span class="number">0</span>, water.getWidth());</span><br><span class="line">                        <span class="keyword">if</span> (!p.grabPixels())</span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                <span class="keyword">throw</span> <span class="keyword">new</span> Exception();</span><br><span class="line">                            &#125; <span class="keyword">catch</span> (Exception e1) &#123;&#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (Exception e2)&#123;&#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (IOException e3) &#123;&#125;</span><br><span class="line">                JFrame frame3 = <span class="keyword">new</span> JFrame();</span><br><span class="line">                JLabel label3 = <span class="keyword">new</span> JLabel();</span><br><span class="line">                label3.setIcon(<span class="keyword">new</span> ImageIcon(water));</span><br><span class="line">                Container c3 = frame3.getContentPane();</span><br><span class="line">                c3.add(label3);</span><br><span class="line">                frame3.pack();</span><br><span class="line">                frame3.setTitle(<span class="string">"水印图像"</span>);</span><br><span class="line">                frame3.setVisible(<span class="keyword">true</span>);</span><br><span class="line">                <span class="keyword">this</span>.setVisible(<span class="keyword">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="waterrecoverListener-java-水印提取应用"><a href="#waterrecoverListener-java-水印提取应用" class="headerlink" title="waterrecoverListener.java (水印提取应用)"></a>waterrecoverListener.java (水印提取应用)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> javax.swing.event.ChangeEvent;</span><br><span class="line"><span class="keyword">import</span> javax.swing.event.ChangeListener;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">waterrecoverListener</span> <span class="keyword">extends</span> <span class="title">JFrame</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> MainWindow mainWindow;</span><br><span class="line">    <span class="keyword">private</span> JFrame frame1 = <span class="keyword">new</span> JFrame(<span class="string">"水印图像"</span>);</span><br><span class="line">    <span class="keyword">private</span> JLabel label5=<span class="keyword">new</span> JLabel();</span><br><span class="line">    <span class="keyword">private</span> JLabel label6=<span class="keyword">new</span> JLabel();</span><br><span class="line">    <span class="keyword">private</span> JSlider slider1,slider2,slider3;</span><br><span class="line">    <span class="keyword">private</span> JLabel label1,label2,label3;</span><br><span class="line">    <span class="keyword">private</span> JButton ok,cancle;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> a;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> b, c;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">waterrecoverListener</span><span class="params">(MainWindow mainWindow)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mainWindow = mainWindow;</span><br><span class="line">        JPanel panel = <span class="keyword">new</span> JPanel();</span><br><span class="line">        panel.setLayout(<span class="keyword">null</span>);</span><br><span class="line">        slider1 = <span class="keyword">new</span> JSlider(<span class="number">1</span>,<span class="number">100</span>,<span class="number">1</span>);</span><br><span class="line">        slider2 = <span class="keyword">new</span> JSlider(<span class="number">1</span>,<span class="number">8</span>,<span class="number">1</span>);</span><br><span class="line">        slider3 = <span class="keyword">new</span> JSlider(<span class="number">1</span>,<span class="number">8</span>,<span class="number">1</span>);</span><br><span class="line">        label1 = <span class="keyword">new</span> JLabel(<span class="string">"0.01"</span>);</span><br><span class="line">        label2 = <span class="keyword">new</span> JLabel(<span class="string">"1"</span>);</span><br><span class="line">        label3 = <span class="keyword">new</span> JLabel(<span class="string">"1"</span>);</span><br><span class="line">        panel.add(slider1);</span><br><span class="line">        slider1.setBounds(<span class="number">20</span>, <span class="number">20</span>, <span class="number">270</span>, <span class="number">20</span>);</span><br><span class="line">        panel.add(label1);</span><br><span class="line">        label1.setBounds(<span class="number">290</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">20</span>);</span><br><span class="line">        panel.add(slider2);</span><br><span class="line">        slider2.setBounds(<span class="number">20</span>, <span class="number">70</span>, <span class="number">270</span>, <span class="number">20</span>);</span><br><span class="line">        panel.add(label2);</span><br><span class="line">        label2.setBounds(<span class="number">290</span>, <span class="number">70</span>, <span class="number">30</span>, <span class="number">20</span>);</span><br><span class="line">        panel.add(slider3);</span><br><span class="line">        slider3.setBounds(<span class="number">20</span>, <span class="number">120</span>, <span class="number">270</span>, <span class="number">20</span>);</span><br><span class="line">        panel.add(label3);</span><br><span class="line">        label3.setBounds(<span class="number">290</span>, <span class="number">120</span>, <span class="number">30</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">        slider1.addChangeListener(<span class="keyword">new</span> ChangeListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stateChanged</span><span class="params">(ChangeEvent e)</span> </span>&#123;</span><br><span class="line">                label1.setText(String.valueOf(slider1.getValue()/<span class="number">100.0</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        slider2.addChangeListener(<span class="keyword">new</span> ChangeListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stateChanged</span><span class="params">(ChangeEvent e)</span> </span>&#123;</span><br><span class="line">                label2.setText(String.valueOf(slider2.getValue()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        slider3.addChangeListener(<span class="keyword">new</span> ChangeListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">stateChanged</span><span class="params">(ChangeEvent e)</span> </span>&#123;</span><br><span class="line">                label3.setText(String.valueOf(slider3.getValue()));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        ok = <span class="keyword">new</span> JButton(<span class="string">"确定"</span>);</span><br><span class="line">        panel.add(ok);</span><br><span class="line">        ok.addActionListener(<span class="keyword">new</span> ActionListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(mainWindow.image!=<span class="keyword">null</span>) &#123;</span><br><span class="line">                    a = slider1.getValue()/<span class="number">100.0</span>;</span><br><span class="line">                    b = slider2.getValue();</span><br><span class="line">                    c = slider3.getValue();</span><br><span class="line">                    waterMark trans = <span class="keyword">new</span> waterMark(mainWindow.image,a,b,c);</span><br><span class="line">                    BufferedImage spec = trans.extract();</span><br><span class="line">                    label5.setIcon(<span class="keyword">new</span> ImageIcon(spec));</span><br><span class="line">                    Container c1 = frame1.getContentPane();</span><br><span class="line">                    c1.add(label5);</span><br><span class="line">                    frame1.pack();</span><br><span class="line">                    frame1.setVisible(<span class="keyword">true</span>);</span><br><span class="line">                    dispose();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        ok.setBounds(<span class="number">60</span>, <span class="number">170</span>, <span class="number">80</span>, <span class="number">30</span>);</span><br><span class="line">        cancle = <span class="keyword">new</span> JButton(<span class="string">"取消"</span>);</span><br><span class="line">        panel.add(cancle);</span><br><span class="line">        cancle.addActionListener(<span class="keyword">new</span> ActionListener() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">                dispose();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        cancle.setBounds(<span class="number">200</span>, <span class="number">170</span>, <span class="number">80</span>, <span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        Container c = getContentPane();</span><br><span class="line">        c.setLayout(<span class="keyword">new</span> BoxLayout(c, BoxLayout.Y_AXIS));</span><br><span class="line">        c.add(panel);</span><br><span class="line">        <span class="keyword">this</span>.setVisible(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">this</span>.setLocationRelativeTo(<span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">this</span>.setSize(<span class="number">380</span>, <span class="number">250</span>);</span><br><span class="line">        <span class="keyword">this</span>.setResizable(<span class="keyword">false</span>);</span><br><span class="line">        <span class="keyword">this</span>.setTitle(<span class="string">"参数设置 alpha-W-H"</span>);</span><br><span class="line">        <span class="keyword">this</span>.setDefaultCloseOperation(WindowConstants.DISPOSE_ON_CLOSE);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setVisible(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="edgeListener-java-边缘检测"><a href="#edgeListener-java-边缘检测" class="headerlink" title="edgeListener.java (边缘检测)"></a>edgeListener.java (边缘检测)</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.swing.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.*;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionEvent;</span><br><span class="line"><span class="keyword">import</span> java.awt.event.ActionListener;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> <span class="keyword">static</span> java.awt.image.BufferedImage.TYPE_INT_RGB;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">edgeListener</span> <span class="keyword">implements</span> <span class="title">ActionListener</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> MainWindow mainWindow;</span><br><span class="line">    <span class="keyword">private</span> String mod;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">edgeListener</span><span class="params">(MainWindow mainWindow,String mod)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.mainWindow = mainWindow;</span><br><span class="line">        <span class="keyword">this</span>.mod = mod;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">actionPerformed</span><span class="params">(ActionEvent e)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(mainWindow.image==<span class="keyword">null</span>)<span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">int</span>[][] result = <span class="keyword">new</span> <span class="keyword">int</span>[mainWindow.width][mainWindow.height];</span><br><span class="line">        <span class="keyword">int</span>[][] gray = <span class="keyword">new</span> <span class="keyword">int</span>[mainWindow.width][mainWindow.height];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;mainWindow.width;j++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;mainWindow.height;k++) &#123;</span><br><span class="line">                Color pixel = <span class="keyword">new</span> Color(mainWindow.image.getRGB(j, k));</span><br><span class="line">                gray[j][k]=(<span class="keyword">int</span>)(pixel.getRed()*<span class="number">0.3</span>+pixel.getGreen()*<span class="number">0.59</span>+pixel.getBlue()*<span class="number">0.11</span>);</span><br><span class="line">                <span class="keyword">if</span>(gray[j][k]&gt;<span class="number">255</span>)gray[j][k]=<span class="number">255</span>;</span><br><span class="line">                <span class="keyword">if</span>(gray[j][k]&lt;<span class="number">0</span>)gray[j][k]=<span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> j=<span class="number">0</span>;j&lt;mainWindow.width;j++)</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> k=<span class="number">0</span>;k&lt;mainWindow.height;k++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(j==<span class="number">0</span>||k==<span class="number">0</span>||j==mainWindow.width-<span class="number">1</span>||k==mainWindow.height-<span class="number">1</span>) &#123;</span><br><span class="line">                    result[j][k] = <span class="number">0</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    <span class="keyword">if</span>(<span class="keyword">this</span>.mod.equals(<span class="string">"sobel"</span>)) &#123;</span><br><span class="line">                        <span class="keyword">int</span> gradx = gray[j - <span class="number">1</span>][k - <span class="number">1</span>] + <span class="number">2</span> * gray[j - <span class="number">1</span>][k] + gray[j - <span class="number">1</span>][k + <span class="number">1</span>]</span><br><span class="line">                                - gray[j + <span class="number">1</span>][k - <span class="number">1</span>] - <span class="number">2</span> * gray[j + <span class="number">1</span>][k] - gray[j + <span class="number">1</span>][k + <span class="number">1</span>];</span><br><span class="line">                        <span class="keyword">int</span> grady = gray[j - <span class="number">1</span>][k - <span class="number">1</span>] + <span class="number">2</span> * gray[j][k - <span class="number">1</span>] + gray[j + <span class="number">1</span>][k - <span class="number">1</span>]</span><br><span class="line">                                - gray[j - <span class="number">1</span>][k + <span class="number">1</span>] - <span class="number">2</span> * gray[j][k + <span class="number">1</span>] - gray[j + <span class="number">1</span>][k + <span class="number">1</span>];</span><br><span class="line">                        result[j][k] = (<span class="keyword">int</span>) Math.sqrt(gradx * gradx + grady * grady);</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.mod.equals(<span class="string">"prewitt"</span>))&#123;</span><br><span class="line">                        <span class="keyword">int</span> gradx = gray[j - <span class="number">1</span>][k - <span class="number">1</span>] + gray[j - <span class="number">1</span>][k] + gray[j - <span class="number">1</span>][k + <span class="number">1</span>]</span><br><span class="line">                                - gray[j + <span class="number">1</span>][k - <span class="number">1</span>] - gray[j + <span class="number">1</span>][k] - gray[j + <span class="number">1</span>][k + <span class="number">1</span>];</span><br><span class="line">                        <span class="keyword">int</span> grady = gray[j - <span class="number">1</span>][k - <span class="number">1</span>] + gray[j][k - <span class="number">1</span>] + gray[j + <span class="number">1</span>][k - <span class="number">1</span>]</span><br><span class="line">                                - gray[j - <span class="number">1</span>][k + <span class="number">1</span>] - gray[j][k + <span class="number">1</span>] - gray[j + <span class="number">1</span>][k + <span class="number">1</span>];</span><br><span class="line">                        result[j][k] = (<span class="keyword">int</span>) Math.sqrt(gradx * gradx + grady * grady);</span><br><span class="line">                    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="keyword">this</span>.mod.equals(<span class="string">"laplace"</span>))&#123;</span><br><span class="line">                        result[j][k] = Math.abs(gray[j - <span class="number">1</span>][k]+gray[j + <span class="number">1</span>][k]+gray[j][k + <span class="number">1</span>]+gray[j][k - <span class="number">1</span>]-<span class="number">4</span>*gray[j][k]);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(result[j][k]&gt;<span class="number">255</span>)</span><br><span class="line">                        result[j][k]=<span class="number">255</span>;</span><br><span class="line">                    <span class="keyword">if</span>(result[j][k]&lt;<span class="number">0</span>)</span><br><span class="line">                        result[j][k]=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        BufferedImage imageOutput=<span class="keyword">new</span> BufferedImage(mainWindow.width, mainWindow.height, TYPE_INT_RGB);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mainWindow.width; i++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; mainWindow.height; j++) &#123;</span><br><span class="line">                imageOutput.setRGB(i,j,<span class="keyword">new</span> Color(result[i][j],result[i][j],result[i][j]).getRGB());</span><br><span class="line">            &#125;</span><br><span class="line">        JFrame frame3 = <span class="keyword">new</span> JFrame();</span><br><span class="line">        JLabel label3 = <span class="keyword">new</span> JLabel();</span><br><span class="line">        label3.setIcon(<span class="keyword">new</span> ImageIcon(imageOutput));</span><br><span class="line">        Container c3 = frame3.getContentPane();</span><br><span class="line">        c3.add(label3);</span><br><span class="line">        frame3.pack();</span><br><span class="line">        frame3.setTitle(<span class="keyword">this</span>.mod+<span class="string">"边缘检测"</span>);</span><br><span class="line">        frame3.setVisible(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="7-Demo-程序"><a href="#7-Demo-程序" class="headerlink" title="7 Demo 程序"></a>7 Demo 程序</h1><ul>
<li><a href="https://file.shivakasu.cn/521ba643eaa3cdd0ac57/demo.exe" target="_blank" rel="noopener">demo.exe</a></li>
</ul>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:wkx1996@foxmail.com">w.k.x.</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://shivakasu.cn/2017/04/01/work2/">https://shivakasu.cn/2017/04/01/work2/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://shivakasu.cn" target="_blank">SHIVAKASU</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/%E5%9B%BE%E5%83%8F%E5%A4%84%E7%90%86/">图像处理</a></div><div class="post_share"><div class="social-share" data-image="http://file.shivakasu.cn/2f6de001e698ed5939de/arg.jpg" data-sites="facebook,twitter,wechat,weibo,qq,qzone,douban,google,linkedin"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"/><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><div class="post-reward"><button class="reward-button"><i class="fas fa-qrcode"></i> 打赏<div class="reward-main"><ul class="reward-all"><li class="reward-item"><img class="post-qr-code__img" src="https://file.shivakasu.cn/4a84dcfb31806db98b2a/wechat.png" alt="微信" onclick="window.open('https://file.shivakasu.cn/4a84dcfb31806db98b2a/wechat.png')"/><div class="post-qr-code__desc">微信</div></li><li class="reward-item"><img class="post-qr-code__img" src="https://file.shivakasu.cn/982f781ef31cbc46968b/alipay.jpg" alt="支付宝" onclick="window.open('https://file.shivakasu.cn/982f781ef31cbc46968b/alipay.jpg')"/><div class="post-qr-code__desc">支付宝</div></li></ul></div></button></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2017/07/01/bugfix0/"><img class="prev-cover" data-src="http://file.shivakasu.cn/625f259cab2ac7f8e1c0/bugfix.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">解决 anaconda3 安装 xgboost：/usr/lib/libstdc++.so.6：version 'GLIBCXX_3.4.14' not found问题</div></div></a></div><div class="next-post pull-right"><a href="/2017/01/28/interview5/"><img class="next-cover" data-src="https://file.shivakasu.cn/f9090341835f7511eae5/bigdata.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">无聊的知识点之大数据</div></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/07/23/arg4/" title="TimSort 在 JDK10 中的实现"><img class="relatedPosts_cover" data-src="http://file.shivakasu.cn/2f6de001e698ed5939de/arg.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2020-07-23</div><div class="relatedPosts_title">TimSort 在 JDK10 中的实现</div></div></a></div><div class="relatedPosts_item"><a href="/2017/01/26/interview2/" title="无聊的知识点之设计模式"><img class="relatedPosts_cover" data-src="https://file.shivakasu.cn/43003cda4506046a2bdd/design.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2017-01-26</div><div class="relatedPosts_title">无聊的知识点之设计模式</div></div></a></div><div class="relatedPosts_item"><a href="/2017/01/25/interview1/" title="无聊的知识点之 Java"><img class="relatedPosts_cover" data-src="https://file.shivakasu.cn/47ac8cadfbd9da344fc9/java.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="far fa-calendar-alt fa-fw"></i> 2017-01-25</div><div class="relatedPosts_title">无聊的知识点之 Java</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div><div class="vcomment" id="vcomment"></div><script src="https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js"></script><script>var requestSetting = function (from,set) {
  var from = from
  var setting = set.split(',').filter(function(item){
  return from.indexOf(item) > -1
  });
  setting = setting.length == 0 ? from :setting;
  return setting
}

var guestInfo = requestSetting(['nick','mail','link'],'nick,mail,link')
var requiredFields = requestSetting(['nick','mail'],'nick,mail')

window.valine = new Valine({
  el:'#vcomment',
  appId: 'qIfwEiuSjlc5vyminB1rx2qX-gzGzoHsz',
  appKey: 'erfVXuW3AybzbWGqxSGxnBRp',
  placeholder: '来都来了，说点儿什么吧~',
  avatar: 'monsterid',
  meta: guestInfo,
  pageSize: '10',
  lang: 'zh-CN',
  recordIP: true,
  serverURLs: '',
  emojiCDN: '',
  emojiMaps: "",
  enableQQ: false,
  requiredFields: requiredFields
});</script></div></article></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2020 By w.k.x.</div><div class="framework-info"><span>DrivenBy </span><a href="https://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div><div class="icp"><a href="http://www.beian.miit.gov.cn/state/outPortal/loginPortal.action" target="_blank" rel="noopener"><img class="icp-icon" src="/img/icp.png"/><span>京ICP备19001969号-1</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><button id="readmode" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="font_plus" title="放大字体"><i class="fas fa-plus"></i></button><button id="font_minus" title="缩小字体"><i class="fas fa-minus"></i></button><button class="translate_chn_to_cht" id="translateLink" title="简繁转换">繁</button><button id="darkmode" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" title="设置"><i class="fas fa-cog"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="scroll_to_comment fas fa-comments"></i></a><button class="close" id="mobile-toc-button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="/js/third-party/fireworks.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js" async></script><script src="https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js"></script><script>document.addEventListener('DOMContentLoaded', function() {
  pangu.autoSpacingPage()
})</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":150,"height":300},"mobile":{"show":false},"react":{"opacity":0.7},"log":false});</script></body></html>